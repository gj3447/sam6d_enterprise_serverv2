========================================
카메라·프레임 파이프라인 개선
========================================

주요 구현:
- 기존 CameraService에 프레임 드롭 감시 로직과 재시도 큐를 추가해 끊김 빈도를 절반 이하로 낮췄다.
- FrameSyncService에서 허용 지연과 버퍼 크기를 실측 기반으로 재조정하고, 이벤트 발행 전에 동기화 통계를 기록하도록 했다.
- ApplicationStore에 컬러/깊이 프레임 히스토리를 5분치 캐싱하도록 확장해 장애 대응 시 원인 분석이 가능하게 만들었다.

세부 작업:
- 카메라 WebSocket 커넥션에 keep-alive ping을 추가해 라즈베리파이 브릿지와의 연결이 조용히 끊기는 문제를 완화.
- 동기화 실패 시 강제 드랍보다 재정렬 우선 전략을 적용해 150ms 이내 jitter 구간에서는 프레임을 살리는 방식으로 변경.
- 상태 보드를 위해 프레임 처리량과 평균 지연을 EventBus 메트릭에 노출.

사소한 메모:
- 라즈베리파이 측 펌웨어가 가끔씩 ping 응답을 늦게 보내는데, 여기까지 건드리면 끝이 없어서 일단 서버 쪽 타임아웃만 완화해둠.

----------------------------------------

========================================
ArUco 감지 및 이미지 후처리 개편
========================================

주요 구현:
- ArucoService 감지 루프를 asyncio 태스크로 분리하고, 좌표계 변환을 별도 유틸로 뽑아 테스트가 가능하도록 리팩터링.
- ImageService에 JPEG 압축 품질 자동 조절을 넣어 네트워크 상황에 따라 화질과 전송량을 맞출 수 있게 했다.
- 감지 결과를 구조화된 DTO로 저장해 WebSocket/HTTP가 같은 데이터를 공유하도록 통합했다.

세부 작업:
- 디버그 오버레이에 마커 ID와 reprojection error를 표시해 현장 튜닝 시간을 줄임.
- 로봇 기준 좌표를 환경 변수로 주입받도록 변경해 테스트에서 별도 JSON 없이 동작하도록 함.
- Perspective 뷰 생성 시 사다리꼴 보정 매트릭스를 캐시해 CPU 사용량을 줄였다.

사소한 메모:
- reprojection error 글꼴을 작게 했더니 현장에서 안 보인다고 해서 글자 크기 두 배로 키웠더니 이번엔 너무 거슬린다고… 결국 회색 반투명 배경을 깔아서 타협함.

----------------------------------------

========================================
스트리밍·이벤트 라우팅 정비
========================================

주요 구현:
- StreamingService에 구독자 기반 플로우 제어를 추가해 불필요한 브로드캐스트를 막고, 이벤트 구독 해제 시 메모리를 즉시 반환.
- ConnectionManager에 연결 보건(health) 핑과 지연 측정 기능을 넣어 대시보드에서 바로 확인 가능하게 했다.
- EventBus 메트릭 로그를 promtail 수집에 맞춰 구조화 JSON으로 출력하도록 조정.

세부 작업:
- `/ws/transforms_*` 스트림에서 프레임별 전송량을 제한하기 위해 throttling 윈도우를 도입.
- 스트리밍 태스크에 backpressure 알람을 붙여 처리량이 밀릴 때 Slack 웹훅으로 알려주도록 구성.
- 테스트용 가짜 구독자 스크립트를 만들어 QA에서 부하 테스트할 때 활용.

사소한 메모:
- throttling 값 찾느라 새벽에 계속 스트림 재시작했더니 프런트 팀에서 서버 또 죽였냐고 연락옴. 다음엔 테스트 시간 공유하기.

----------------------------------------

========================================
로봇 IK 및 포인트클라우드 확장
========================================

주요 구현:
- Pinocchio 기반 역기구학 파이프라인을 비동기 초기화로 전환해 서버 기동 시간을 안정화.
- IKPy 경로 계산에서 singularity 감지를 추가해 비정상 자세를 사전에 차단.
- PointcloudService를 도입해 실시간 포인트클라우드 데이터를 JSON 스트림으로 전송하고, downsample 옵션을 API 파라미터로 노출.

세부 작업:
- URDF 로딩 시 로컬 캐시를 사용해 반복 로딩 시간을 줄이고, 실패 시 재시도 로직을 넣었다.
- 로봇 목표 Pose 입력을 검증하는 Pydantic 모델을 추가해 잘못된 요청을 빠르게 차단.
- 포인트클라우드 변환 시 VoxelGrid 크기를 조절해 현장에서 원하는 밀도로 맞출 수 있게 했다.

사소한 메모:
- 포인트클라우드 downsample 기본값을 줄였더니 “점이 너무 많다”는 피드백이 와서 다시 올림. 숫자 하나 바꾸는데 의견 합치는 데 하루 걸림.

----------------------------------------

========================================
운영 자동화 및 관측성 강화
========================================

주요 구현:
- README, API 문서, 내부 보고서에 최신 엔드포인트, 환경 변수, 장애 대응 절차를 반영.
- EventBus와 StreamingService 로그를 Loki로 수집하고, Grafana 대시보드에 프레임 지연·IK 처리 시간·WebSocket 연결 수를 시각화.
- 배포 스크립트에서 Pinocchio 빌드 확인과 `.env` 검증을 자동화해 릴리즈 안정성을 높였다.

세부 작업:
- pytest 로봇 시뮬레이션 케이스를 CI에 추가해 PR마다 역기구학 기본 검증이 돌도록 함.
- WebSocket 연결 수가 급증하면 Redis 캐시를 비우고 알람을 보내는 간단한 방어 로직을 추가.
- 장애 시 참고할 수 있도록 report/ 디렉터리에 일지와 체크리스트를 함께 보관.

사소한 메모:
- Grafana 패널 색깔을 파랑으로 맞춰놨는데 “눈부시다”는 의견이 있어서 약간 톤다운. 대시보드 컬러도 토론 주제라니.

----------------------------------------

========================================
외부 연동 및 테스트 기록
========================================

내용:
- 라즈베리파이 RealSense 브릿지와 FastAPI 서버 간 WebSocket 재연결 시나리오를 반복 검증(1시간 스트레스 테스트, 최대 지연 220ms 확인).
- RSS 추론 서버와의 joint pipeline을 구성해 IK → 로봇 모션 → 포인트클라우드 업데이트 흐름을 10회 연속 실행, 실패 없음.
- DRL Modbus 브릿지와 연동해 로봇 관절 명령을 실제 PLC로 전달하고 피드백 값을 수집, 이벤트 지연 평균 180ms로 기록.
- 프런트엔드 대시보드와 실시간 스트림 호환성 확인, Safari/iPad 포함 4종 브라우저에서 WebSocket 호환 테스트 완료.

사소한 메모:
- 야간에 스트레스 테스트 돌리다가 팬 소리가 커져서 서버실 내려가봤더니 도어락이 잠겨 있어서 한참 서 있었음. 다음부터는 사전에 열쇠 챙기기.

----------------------------------------