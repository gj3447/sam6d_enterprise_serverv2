# ISM_Server ë‚´ì¼ ì‘ì—… ê³„íš

## ğŸ“‹ í˜„ì¬ ìƒí™©
- âœ… **Phase 0 ì™„ë£Œ**: Docker í™˜ê²½ ë° ë¼ì´ë¸ŒëŸ¬ë¦¬ Import í…ŒìŠ¤íŠ¸ ì„±ê³µ
- âœ… Docker ì»¨í…Œì´ë„ˆ ì •ìƒ ì‘ë™ (`ism-server`)
- âœ… SAM-6D ê´€ë ¨ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì •ìƒ import
- âœ… `run_inference_custom_function` ëª¨ë“ˆ ì‚¬ìš© ê°€ëŠ¥ í™•ì¸

## ğŸ¯ ë‚´ì¼ í•´ì•¼í•  ì‘ì—…ë“¤

### Phase 1: ê¸°ë³¸ FastAPI ì„œë²„ êµ¬í˜„ ë° í…ŒìŠ¤íŠ¸
**ëª©í‘œ**: ê¸°ë³¸ì ì¸ FastAPI ì„œë²„ êµ¬ì¡° ì™„ì„±

#### 1.1 ê¸°ë³¸ ì„œë²„ êµ¬ì¡° êµ¬í˜„
- [ ] `main.py` í™•ì¥ - ê¸°ë³¸ FastAPI ì•± êµ¬ì¡°
- [ ] Pydantic ëª¨ë¸ ì •ì˜ (Request/Response ìŠ¤í‚¤ë§ˆ)
- [ ] ê¸°ë³¸ ì—”ë“œí¬ì¸íŠ¸ êµ¬í˜„:
  - `GET /` - ì„œë²„ ìƒíƒœ í™•ì¸
  - `GET /health` - í—¬ìŠ¤ì²´í¬
  - `GET /api/v1/status` - ìƒì„¸ ìƒíƒœ ì •ë³´

#### 1.2 ì„œë²„ í…ŒìŠ¤íŠ¸
- [ ] ì»¨í…Œì´ë„ˆ ë‚´ì—ì„œ FastAPI ì„œë²„ ì‹¤í–‰ í…ŒìŠ¤íŠ¸
- [ ] í¬íŠ¸ 8002 ì ‘ê·¼ í…ŒìŠ¤íŠ¸
- [ ] ê¸°ë³¸ ì—”ë“œí¬ì¸íŠ¸ ë™ì‘ í™•ì¸

**ì˜ˆìƒ ì†Œìš”ì‹œê°„**: 1-2ì‹œê°„

---

### Phase 2: ëª¨ë¸ ë¡œë”© ê¸°ëŠ¥ êµ¬í˜„ ë° í…ŒìŠ¤íŠ¸
**ëª©í‘œ**: ì„œë²„ ì‹œì‘ ì‹œ SAM-6D ëª¨ë¸ê³¼ í…œí”Œë¦¿ ë°ì´í„° ë¡œë”©

#### 2.1 ëª¨ë¸ ë¡œë”© ë¡œì§ êµ¬í˜„
- [ ] `@app.on_event("startup")` ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ êµ¬í˜„
- [ ] SAM-6D ëª¨ë¸ ë¡œë”© í•¨ìˆ˜ êµ¬í˜„
- [ ] í…œí”Œë¦¿ ë°ì´í„° ë¡œë”© í•¨ìˆ˜ êµ¬í˜„
- [ ] CAD ëª¨ë¸ ë¡œë”© í•¨ìˆ˜ êµ¬í˜„
- [ ] ì „ì—­ ë³€ìˆ˜ë¡œ ëª¨ë¸ ë°ì´í„° ì €ì¥

#### 2.2 ëª¨ë¸ ë¡œë”© í…ŒìŠ¤íŠ¸
- [ ] ì„œë²„ ì‹œì‘ ì‹œ ëª¨ë¸ ë¡œë”© ì„±ê³µ í™•ì¸
- [ ] ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ í™•ì¸
- [ ] ë¡œë”© ì‹œê°„ ì¸¡ì •
- [ ] ì—ëŸ¬ í•¸ë“¤ë§ í…ŒìŠ¤íŠ¸

**ì˜ˆìƒ ì†Œìš”ì‹œê°„**: 2-3ì‹œê°„

---

### Phase 3: ì¶”ë¡  API êµ¬í˜„ ë° í…ŒìŠ¤íŠ¸
**ëª©í‘œ**: ì‹¤ì œ ì´ë¯¸ì§€ ì¶”ë¡  API ì™„ì„±

#### 3.1 ì¶”ë¡  API êµ¬í˜„
- [ ] `POST /api/v1/inference` ì—”ë“œí¬ì¸íŠ¸ êµ¬í˜„
- [ ] ì´ë¯¸ì§€ ë°ì´í„° ì²˜ë¦¬ (Base64 ë””ì½”ë”©)
- [ ] `run_inference_custom_function` í˜¸ì¶œ
- [ ] ê²°ê³¼ í¬ë§·íŒ… ë° ë°˜í™˜

#### 3.2 ì¶”ë¡  API í…ŒìŠ¤íŠ¸
- [ ] ìƒ˜í”Œ ì´ë¯¸ì§€ë¡œ ì¶”ë¡  í…ŒìŠ¤íŠ¸
- [ ] ì‘ë‹µ ì‹œê°„ ì¸¡ì •
- [ ] ì—ëŸ¬ ì¼€ì´ìŠ¤ ì²˜ë¦¬ í…ŒìŠ¤íŠ¸
- [ ] ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ í™•ì¸

**ì˜ˆìƒ ì†Œìš”ì‹œê°„**: 2-3ì‹œê°„

---

### Phase 4: Docker í†µí•© ë° ìµœì¢… í…ŒìŠ¤íŠ¸
**ëª©í‘œ**: í”„ë¡œë•ì…˜ í™˜ê²½ ì¤€ë¹„

#### 4.1 Docker ìµœì í™”
- [ ] Dockerfile ìµœì í™” (ë©€í‹°ìŠ¤í…Œì´ì§€ ë¹Œë“œ)
- [ ] í™˜ê²½ë³€ìˆ˜ ì •ë¦¬
- [ ] ë¡œê·¸ ì„¤ì •

#### 4.2 ìµœì¢… í…ŒìŠ¤íŠ¸
- [ ] ì „ì²´ ì›Œí¬í”Œë¡œìš° í…ŒìŠ¤íŠ¸
- [ ] ì„±ëŠ¥ ë²¤ì¹˜ë§ˆí¬
- [ ] ë¬¸ì„œí™” ì™„ì„±

**ì˜ˆìƒ ì†Œìš”ì‹œê°„**: 1-2ì‹œê°„

---

## ğŸ”§ í•„ìš”í•œ íŒŒì¼ë“¤

### ìƒˆë¡œ ìƒì„±í•  íŒŒì¼ë“¤
- [ ] `models.py` - Pydantic ëª¨ë¸ ì •ì˜
- [ ] `model_loader.py` - ëª¨ë¸ ë¡œë”© ë¡œì§
- [ ] `test_server.py` - ì„œë²„ í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸
- [ ] `sample_images/` - í…ŒìŠ¤íŠ¸ìš© ì´ë¯¸ì§€ í´ë”

### ìˆ˜ì •í•  íŒŒì¼ë“¤
- [ ] `main.py` - FastAPI ì„œë²„ í™•ì¥
- [ ] `requirements.txt` - ì¶”ê°€ ì˜ì¡´ì„± (í•„ìš”ì‹œ)
- [ ] `docker-compose.yml` - í”„ë¡œë•ì…˜ ì„¤ì •

---

## ğŸ“ êµ¬í˜„ ì„¸ë¶€ì‚¬í•­

### Phase 1 êµ¬í˜„ ì˜ˆì‹œ
```python
# main.py í™•ì¥
from fastapi import FastAPI, HTTPException
from pydantic import BaseModel
from typing import Optional
import os
import sys

# SAM-6D ëª¨ë“ˆ import
sys.path.append('/workspace/Estimation_Server/SAM-6D/SAM-6D/Instance_Segmentation_Model')
from run_inference_custom_function import run_inference_core, load_templates_from_files

app = FastAPI(title="ISM Server", version="1.0.0")

# ì „ì—­ ë³€ìˆ˜
model = None
templates_data = None
templates_masks = None
templates_boxes = None
cad_points = None

@app.on_event("startup")
async def startup_event():
    """ì„œë²„ ì‹œì‘ ì‹œ ëª¨ë¸ ë¡œë”©"""
    global model, templates_data, templates_masks, templates_boxes, cad_points
    # ëª¨ë¸ ë¡œë”© ë¡œì§ êµ¬í˜„ ì˜ˆì •
    pass

@app.get("/")
async def read_root():
    return {"message": "ISM Server is running!", "version": "1.0.0"}

@app.get("/health")
async def health_check():
    return {"status": "healthy", "model_loaded": model is not None}

@app.get("/api/v1/status")
async def get_status():
    return {
        "server": "running",
        "model_loaded": model is not None,
        "templates_loaded": templates_data is not None,
        "cad_loaded": cad_points is not None
    }
```

### Phase 2 êµ¬í˜„ ì˜ˆì‹œ
```python
@app.on_event("startup")
async def startup_event():
    """ì„œë²„ ì‹œì‘ ì‹œ ëª¨ë¸ ë¡œë”©"""
    global model, templates_data, templates_masks, templates_boxes, cad_points
    
    try:
        # 1. í…œí”Œë¦¿ ë°ì´í„° ë¡œë”©
        template_dir = os.getenv('ISM_TEMPLATE_DIR')
        templates_data, templates_masks, templates_boxes = load_templates_from_files(template_dir)
        
        # 2. CAD ëª¨ë¸ ë¡œë”©
        cad_path = os.getenv('ISM_CAD_MODEL_PATH')
        cad_points = load_cad_model(cad_path)
        
        # 3. SAM ëª¨ë¸ ë¡œë”©
        model = load_sam_model()
        
        print("âœ… ëª¨ë“  ëª¨ë¸ì´ ì„±ê³µì ìœ¼ë¡œ ë¡œë”©ë˜ì—ˆìŠµë‹ˆë‹¤.")
        
    except Exception as e:
        print(f"âŒ ëª¨ë¸ ë¡œë”© ì‹¤íŒ¨: {e}")
        raise e
```

---

## ğŸš€ ì‹¤í–‰ ìˆœì„œ

### ë‚´ì¼ ì‘ì—… ì‹œì‘ ì „ ì²´í¬ë¦¬ìŠ¤íŠ¸
- [ ] Docker ì»¨í…Œì´ë„ˆ ì‹¤í–‰ ìƒíƒœ í™•ì¸
- [ ] SAM-6D íŒŒì¼ë“¤ ì ‘ê·¼ ê°€ëŠ¥ í™•ì¸
- [ ] í˜„ì¬ ì‘ì—… ë””ë ‰í† ë¦¬ í™•ì¸ (`C:\CD\PROJECT\BINPICKING\Estimation_Server\ISM_Server`)

### ì‘ì—… ì‹œì‘ ëª…ë ¹ì–´
```bash
# ì»¨í…Œì´ë„ˆ ìƒíƒœ í™•ì¸
docker ps

# ì»¨í…Œì´ë„ˆ ì ‘ì† (í•„ìš”ì‹œ)
docker exec -it ism-server bash

# ì»¨í…Œì´ë„ˆ ë‚´ì—ì„œ ì‘ì—…
source /opt/conda/etc/profile.d/conda.sh
conda activate sam6d
cd /workspace/ISM_Server
```

---

## âš ï¸ ì£¼ì˜ì‚¬í•­

1. **ë©”ëª¨ë¦¬ ê´€ë¦¬**: ëª¨ë¸ ë¡œë”© ì‹œ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ëª¨ë‹ˆí„°ë§
2. **ì—ëŸ¬ í•¸ë“¤ë§**: ê° ë‹¨ê³„ë³„ ì˜ˆì™¸ ì²˜ë¦¬ êµ¬í˜„
3. **ë¡œê¹…**: ë””ë²„ê¹…ì„ ìœ„í•œ ìƒì„¸ ë¡œê·¸ ì¶”ê°€
4. **í…ŒìŠ¤íŠ¸**: ê° Phase ì™„ë£Œ í›„ ë°˜ë“œì‹œ í…ŒìŠ¤íŠ¸ ì‹¤í–‰

---

## ğŸ“Š ì„±ê³µ ê¸°ì¤€

- [ ] Phase 1: FastAPI ì„œë²„ê°€ ì •ìƒì ìœ¼ë¡œ ì‹¤í–‰ë˜ê³  ê¸°ë³¸ ì—”ë“œí¬ì¸íŠ¸ ì‘ë‹µ
- [ ] Phase 2: ì„œë²„ ì‹œì‘ ì‹œ ëª¨ë“  ëª¨ë¸ì´ ì„±ê³µì ìœ¼ë¡œ ë¡œë”©
- [ ] Phase 3: ì‹¤ì œ ì´ë¯¸ì§€ë¡œ ì¶”ë¡ ì´ ì •ìƒì ìœ¼ë¡œ ìˆ˜í–‰
- [ ] Phase 4: Docker í™˜ê²½ì—ì„œ ì•ˆì •ì ìœ¼ë¡œ ì„œë¹„ìŠ¤ ì œê³µ

---

**ì´ ì˜ˆìƒ ì†Œìš”ì‹œê°„**: 6-10ì‹œê°„  
**ìš°ì„ ìˆœìœ„**: Phase 1 â†’ Phase 2 â†’ Phase 3 â†’ Phase 4
