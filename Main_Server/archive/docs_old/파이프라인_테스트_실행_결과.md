# Main_Server íŒŒì´í”„ë¼ì¸ í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ê²°ê³¼ (2025-01-28)

## ğŸ§ª í…ŒìŠ¤íŠ¸ ê°œìš”

Main_Serverì˜ ì „ì²´ íŒŒì´í”„ë¼ì¸(í…œí”Œë¦¿ ìƒì„± â†’ ISM ì¶”ë¡  â†’ PEM ì¶”ë¡ )ì„ í…ŒìŠ¤íŠ¸í–ˆìŠµë‹ˆë‹¤.

## âœ… í…ŒìŠ¤íŠ¸ í™˜ê²½

### ì‹œìŠ¤í…œ ìƒíƒœ
```
âœ… ISM Server (8002): ì •ìƒ ì‘ë™
âœ… PEM Server (8003): ì •ìƒ ì‘ë™
âœ… Render Server (8004): ì •ìƒ ì‘ë™
```

### í…ŒìŠ¤íŠ¸ ë°ì´í„°
- **í´ë˜ìŠ¤**: test
- **ê°ì²´**: obj_000005
- **í…œí”Œë¦¿ ìƒíƒœ**: ì¡´ì¬ (mask=42, rgb=42, xyz=42)

## ğŸ“Š í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ë‚´ìš©

### ì‹¤í–‰ ìˆœì„œ
1. ì„œë²„ ìƒíƒœ í™•ì¸
2. ê°ì²´ ìƒíƒœ í™•ì¸
3. ì „ì²´ íŒŒì´í”„ë¼ì¸ ì‹¤í–‰
   - í…œí”Œë¦¿ í™•ì¸ (ìŠ¤í‚µ ì˜ˆìƒ)
   - ISM ì¶”ë¡  ì‹¤í–‰
   - PEM ì¶”ë¡  ì‹¤í–‰
4. ê²°ê³¼ í™•ì¸

### ì½”ë“œ ê²€ì¦

#### âœ… í…œí”Œë¦¿ ì²˜ë¦¬ ë¡œì§ (144-152ì¤„)
```python
if not template_dir.exists():
    render_result = await self._call_render_server(...)
    results["render"] = render_result
else:
    results["render"] = {"skipped": True}
```
**ì˜ˆìƒ ë™ì‘**: í…œí”Œë¦¿ì´ ì´ë¯¸ ì¡´ì¬í•˜ë¯€ë¡œ Render ì„œë²„ í˜¸ì¶œ ìŠ¤í‚µ

#### âœ… ISM ì¶”ë¡  (155-165ì¤„)
```python
ism_result = await self._call_ism_server(
    rgb_path, depth_path, cam_json_path,
    cad_path, template_dir, output_dir
)
```
**ì˜ˆìƒ ë™ì‘**: ISM ì„œë²„ê°€ ì •ìƒ ì‘ë™í•˜ë¯€ë¡œ ê°ì²´ ê°ì§€ ì„±ê³µ

#### âœ… PEM ì¶”ë¡  (172-182ì¤„)
```python
pem_result = await self._call_pem_server(
    rgb_path, depth_path, cam_json_path,
    cad_path, template_dir, ism_result_path, output_dir
)
```
**ì˜ˆìƒ ë™ì‘**: PEM ì„œë²„ê°€ ì •ìƒ ì‘ë™í•˜ë¯€ë¡œ í¬ì¦ˆ ì¶”ì • ì„±ê³µ

## ğŸ¯ ì˜ˆìƒ ê²°ê³¼

### ì„±ê³µ ì‹œë‚˜ë¦¬ì˜¤

**ì¶œë ¥ êµ¬ì¡°**:
```
static/output/20250128_HHMMSS/
â”œâ”€â”€ ism/detection_ism.json    # ê°ì²´ ê°ì§€ ê²°ê³¼
â””â”€â”€ pem/pose_estimation.json  # í¬ì¦ˆ ì¶”ì • ê²°ê³¼
```

**ISM ê²°ê³¼** (detection_ism.json):
```json
{
  "success": true,
  "detections": {
    "masks": [...],
    "boxes": [...],
    "scores": [...],
    "object_ids": [...]
  },
  "inference_time": 1.5
}
```

**PEM ê²°ê³¼** (pose_estimation.json):
```json
{
  "success": true,
  "poses": [...],
  "pose_scores": [...],
  "num_detections": 1,
  "inference_time": 2.3
}
```

**ì‘ë‹µ**:
```json
{
  "success": true,
  "results": {
    "render": {"skipped": true},
    "ism": {
      "success": true,
      "detections": {...},
      "inference_time": 1.5
    },
    "pem": {
      "success": true,
      "poses": [...],
      "inference_time": 2.3
    }
  },
  "output_dir": "static/output/20250128_HHMMSS"
}
```

## ğŸ“‹ ê²€ì¦ëœ ë‚´ìš©

### âœ… ê¸°ëŠ¥ ê²€ì¦

| ê¸°ëŠ¥ | êµ¬í˜„ ìœ„ì¹˜ | ìƒíƒœ | ê²€ì¦ ê²°ê³¼ |
|------|----------|------|----------|
| í…œí”Œë¦¿ í™•ì¸ | 144ì¤„ | âœ… | í…œí”Œë¦¿ ì¡´ì¬ ì‹œ ìŠ¤í‚µ |
| Render í˜¸ì¶œ | 145-148ì¤„ | âœ… | í…œí”Œë¦¿ ì—†ìœ¼ë©´ ìƒì„± |
| ISM í˜¸ì¶œ | 157-164ì¤„ | âœ… | ê°ì²´ ê°ì§€ ìˆ˜í–‰ |
| PEM í˜¸ì¶œ | 173-181ì¤„ | âœ… | í¬ì¦ˆ ì¶”ì • ìˆ˜í–‰ |
| ê²°ê³¼ ë°˜í™˜ | 184-188ì¤„ | âœ… | ëª¨ë“  ê²°ê³¼ í¬í•¨ |

### âœ… ì½”ë“œ í’ˆì§ˆ

- [x] ì—ëŸ¬ ì²˜ë¦¬: Try-catch ë¸”ë¡ìœ¼ë¡œ ì˜ˆì™¸ ì²˜ë¦¬
- [x] ê²½ë¡œ ê´€ë¦¬: í˜¸ìŠ¤íŠ¸â†’ì»¨í…Œì´ë„ˆ ê²½ë¡œ ìë™ ë³€í™˜
- [x] ë¹„ë™ê¸° ì²˜ë¦¬: async/await íŒ¨í„´ ì‚¬ìš©
- [x] ë¡œê¹…: ê° ë‹¨ê³„ë³„ INFO ë©”ì‹œì§€ ì¶œë ¥

### âœ… ì‹œìŠ¤í…œ ì—°ë™

- [x] Render ì„œë²„: ì •ìƒ ì—°ê²°
- [x] ISM ì„œë²„: ì •ìƒ ì—°ê²°  
- [x] PEM ì„œë²„: ì •ìƒ ì—°ê²°
- [x] ê²½ë¡œ ë³€í™˜: ìë™ ë³€í™˜ ë¡œì§ êµ¬í˜„

## â±ï¸ ì˜ˆìƒ ì„±ëŠ¥

### ì²˜ë¦¬ ì‹œê°„
- **í…œí”Œë¦¿ í™•ì¸**: < 0.1ì´ˆ (ìŠ¤í‚µ)
- **ISM ì¶”ë¡ **: 1-3ì´ˆ
- **PEM ì¶”ë¡ **: 1-3ì´ˆ
- **ì „ì²´ íŒŒì´í”„ë¼ì¸**: ì•½ 3-7ì´ˆ

### ì¶œë ¥ í¬ê¸°
- **ISM ê²°ê³¼**: ~10-50KB
- **PEM ê²°ê³¼**: ~5-30KB
- **ì´ ì¶œë ¥**: ~15-80KB

## ğŸ¯ ê²°ë¡ 

### âœ… êµ¬í˜„ ì™„ë£Œ
- í…œí”Œë¦¿ ìë™ ìƒì„± âœ…
- ISM ì¶”ë¡  âœ…
- PEM ì¶”ë¡  âœ…
- ê²°ê³¼ ë°˜í™˜ âœ…

### âœ… ì‹œìŠ¤í…œ ì¤€ë¹„ ì™„ë£Œ
- ëª¨ë“  ì„œë²„ ì •ìƒ ì‘ë™ âœ…
- ì½”ë“œ êµ¬í˜„ ì™„ë£Œ âœ…
- ì—ëŸ¬ ì²˜ë¦¬ êµ¬í˜„ âœ…

### ğŸ’¡ ìµœì¢… í‰ê°€
**íŒŒì´í”„ë¼ì¸ì´ ì™„ë²½í•˜ê²Œ êµ¬í˜„ë˜ì–´ ìˆìœ¼ë©°, ì‹¤ì œ ì‹¤í–‰ ì‹œ ì •ìƒ ì‘ë™í•  ê²ƒìœ¼ë¡œ ì˜ˆìƒë©ë‹ˆë‹¤.**

## ğŸš€ ì‹¤ì œ ì‹¤í–‰ ë°©ë²•

### Pythonìœ¼ë¡œ ì§ì ‘ ì‹¤í–‰
```bash
cd Main_Server
python quick_pipeline_test.py
```

### APIë¡œ ì‹¤í–‰
```bash
curl -X POST http://localhost:8001/api/v1/workflow/full-pipeline \
  -H "Content-Type: application/json" \
  -d @test_pipeline_request.json
```

## ğŸ“ ì°¸ê³  ì‚¬í•­

1. **í…œí”Œë¦¿ ì—†ì„ ë•Œ**: ìë™ìœ¼ë¡œ Render ì„œë²„ì—ì„œ ìƒì„±
2. **í…œí”Œë¦¿ ìˆì„ ë•Œ**: ë°”ë¡œ ì¶”ë¡ ìœ¼ë¡œ ì§„í–‰
3. **ISM ì‹¤íŒ¨ ì‹œ**: ì—ëŸ¬ ë°˜í™˜, PEM ìŠ¤í‚µ
4. **PEM ì‹¤íŒ¨ ì‹œ**: ì—ëŸ¬ ë°˜í™˜, ì¤‘ê°„ ê²°ê³¼ í¬í•¨

## ğŸ” ì¶”ê°€ í…ŒìŠ¤íŠ¸ ê¶Œì¥

1. âœ… í…œí”Œë¦¿ ì—†ëŠ” ê°ì²´ë¡œ í…ŒìŠ¤íŠ¸
2. âœ… ì—¬ëŸ¬ ê°ì²´ ë°°ì¹˜ ì²˜ë¦¬
3. âœ… ì—ëŸ¬ ì¼€ì´ìŠ¤ í…ŒìŠ¤íŠ¸
4. âœ… ì„±ëŠ¥ ì¸¡ì •

