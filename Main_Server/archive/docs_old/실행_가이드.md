# Main_Server ì‹¤í–‰ ê°€ì´ë“œ

## ğŸ¯ ì„œë²„ ê°œìš”

Main_ServerëŠ” í¬íŠ¸ 8001ì—ì„œ ì‹¤í–‰ë˜ëŠ” ì¤‘ì•™ ê´€ë¦¬ ì„œë²„ë¡œ, ë‹¤ìŒ ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤:

1. **ê°ì²´ ë°ì´í„°ë² ì´ìŠ¤ ê´€ë¦¬**: Static í´ë” ìŠ¤ìº” ë° ê°ì²´ ì •ë³´ ì œê³µ
2. **ì„œë²„ ìƒíƒœ ëª¨ë‹ˆí„°ë§**: ISM, PEM, Render ì„œë²„ í—¬ìŠ¤ ì²´í¬
3. **ì›Œí¬í”Œë¡œìš° ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜**: ì „ì²´ íŒŒì´í”„ë¼ì¸ ìë™ ì‹¤í–‰

## ğŸ“ êµ¬í˜„ëœ íŒŒì¼ êµ¬ì¡°

```
Main_Server/
â”œâ”€â”€ api/
â”‚   â”œâ”€â”€ models.py                      # Pydantic ëª¨ë¸
â”‚   â””â”€â”€ endpoints/
â”‚       â”œâ”€â”€ objects.py                 # ê°ì²´ ê´€ë¦¬ API
â”‚       â”œâ”€â”€ servers.py                 # ì„œë²„ ìƒíƒœ API
â”‚       â””â”€â”€ workflow.py                # ì›Œí¬í”Œë¡œìš° API
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ scanner.py                     # Static í´ë” ìŠ¤ìº”
â”‚   â”œâ”€â”€ server_monitor.py              # ì„œë²„ ëª¨ë‹ˆí„°ë§
â”‚   â””â”€â”€ workflow_service.py            # ì›Œí¬í”Œë¡œìš° ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜
â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ file_utils.py                  # íŒŒì¼ ìœ í‹¸ë¦¬í‹°
â”‚   â””â”€â”€ path_utils.py                  # ê²½ë¡œ ìœ í‹¸ë¦¬í‹°
â”œâ”€â”€ main.py                            # FastAPI ì• í”Œë¦¬ì¼€ì´ì…˜
â”œâ”€â”€ requirements.txt                    # ì˜ì¡´ì„±
â””â”€â”€ ì‹¤í–‰_ê°€ì´ë“œ.md                     # ì´ íŒŒì¼
```

## ğŸš€ ì‹¤í–‰ ë°©ë²•

### 1. ë¡œì»¬ í™˜ê²½ì—ì„œ ì‹¤í–‰

```bash
cd Main_Server

# ì˜ì¡´ì„± ì„¤ì¹˜
pip install -r requirements.txt

# ì„œë²„ ì‹¤í–‰
python main.py
# ë˜ëŠ”
uvicorn main:app --host 0.0.0.0 --port 8001 --reload
```

### 2. Docker Composeë¡œ ì‹¤í–‰ (ì¶”ì²œ)

ë¨¼ì € `docker-compose.yml` íŒŒì¼ì„ ìƒì„±í•´ì•¼ í•©ë‹ˆë‹¤:

```yaml
version: '3.8'

services:
  main-server:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: main-server
    ports:
      - "8001:8001"
    volumes:
      - ../static:/app/static
    environment:
      - PROJECT_ROOT=/app
    depends_on:
      - ism-server
      - pem-server
      - render-server
    networks:
      - estimation-network

networks:
  estimation-network:
    external: true
```

ê·¸ë¦¬ê³  `Dockerfile`ë„ í•„ìš”í•©ë‹ˆë‹¤:

```dockerfile
FROM python:3.9-slim

WORKDIR /app

COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

COPY . .

EXPOSE 8001

CMD ["uvicorn", "main:app", "--host", "0.0.0.0", "--port", "8001"]
```

ì‹¤í–‰:
```bash
cd Main_Server
docker-compose up -d
```

## ğŸ“¡ API ì—”ë“œí¬ì¸íŠ¸

ì„œë²„ê°€ ì‹œì‘ë˜ë©´ ë‹¤ìŒ URLì—ì„œ APIë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

- **Swagger UI**: http://localhost:8001/docs
- **ReDoc**: http://localhost:8001/redoc

### ì£¼ìš” API ì—”ë“œí¬ì¸íŠ¸

#### 1. ê°ì²´ ê´€ë¦¬

- `GET /api/v1/objects/classes` - ëª¨ë“  í´ë˜ìŠ¤ ëª©ë¡
- `GET /api/v1/objects/classes/{class_name}` - íŠ¹ì • í´ë˜ìŠ¤ì˜ ê°ì²´ ëª©ë¡
- `GET /api/v1/objects/{class_name}/{object_name}` - íŠ¹ì • ê°ì²´ ìƒì„¸ ì •ë³´
- `POST /api/v1/objects/scan` - ê°ì²´ ë””ë ‰í† ë¦¬ ì¬ìŠ¤ìº”

#### 2. ì„œë²„ ìƒíƒœ

- `GET /api/v1/servers/status` - ëª¨ë“  ì„œë²„ ìƒíƒœ í™•ì¸
- `GET /api/v1/servers/status/{server_name}` - íŠ¹ì • ì„œë²„ ìƒíƒœ í™•ì¸
- `GET /api/v1/servers/health` - í—¬ìŠ¤ ì²´í¬

#### 3. ì›Œí¬í”Œë¡œìš°

- `POST /api/v1/workflow/render-templates` - í…œí”Œë¦¿ ìƒì„± ì‘ì—…
- `POST /api/v1/workflow/full-pipeline` - ì „ì²´ íŒŒì´í”„ë¼ì¸ ì‹¤í–‰
- `GET /api/v1/workflow/health` - í—¬ìŠ¤ ì²´í¬

## ğŸ” ì‚¬ìš© ì˜ˆì‹œ

### 1. í´ë˜ìŠ¤ ëª©ë¡ ì¡°íšŒ

```bash
curl http://localhost:8001/api/v1/objects/classes
```

### 2. ì„œë²„ ìƒíƒœ í™•ì¸

```bash
curl http://localhost:8001/api/v1/servers/status
```

### 3. í…œí”Œë¦¿ ìƒì„±

```bash
curl -X POST http://localhost:8001/api/v1/workflow/render-templates \
  -H "Content-Type: application/json" \
  -d '{
    "class_name": "test",
    "object_names": ["obj_000005"],
    "force_regenerate": false
  }'
```

### 4. ì „ì²´ íŒŒì´í”„ë¼ì¸ ì‹¤í–‰

```bash
curl -X POST http://localhost:8001/api/v1/workflow/full-pipeline \
  -H "Content-Type: application/json" \
  -d '{
    "class_name": "test",
    "object_name": "obj_000005",
    "input_images": {
      "rgb_path": "static/test/rgb.png",
      "depth_path": "static/test/depth.png",
      "camera_path": "static/test/camera.json"
    },
    "output_dir": "static/output/run_12345"
  }'
```

## âš ï¸ ì£¼ì˜ì‚¬í•­

1. **ì˜ì¡´ì„± ì„œë²„**: ISM, PEM, Render ì„œë²„ê°€ ë¨¼ì € ì‹¤í–‰ë˜ì–´ ìˆì–´ì•¼ í•©ë‹ˆë‹¤.
2. **ê²½ë¡œ ì„¤ì •**: Static í´ë” ê²½ë¡œê°€ ì˜¬ë°”ë¥´ê²Œ ì„¤ì •ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.
3. **ì›Œí¬í”Œë¡œìš°**: í˜„ì¬ ISM/PEM ì„œë²„ í˜¸ì¶œì€ TODOë¡œ ë‚¨ì•„ìˆì–´ ì‹¤ì œ ê¸°ëŠ¥ì„ êµ¬í˜„í•´ì•¼ í•©ë‹ˆë‹¤.

## ğŸ”§ ë¬¸ì œ í•´ê²°

### ì„œë²„ê°€ ì‹œì‘ë˜ì§€ ì•ŠëŠ” ê²½ìš°

```bash
# ë¡œê·¸ í™•ì¸
docker logs main-server

# ì˜ì¡´ì„± í™•ì¸
pip install -r requirements.txt

# í¬íŠ¸ í™•ì¸
netstat -an | grep 8001
```

### API ì—ëŸ¬ê°€ ë°œìƒí•˜ëŠ” ê²½ìš°

```bash
# ì„œë²„ ìƒíƒœ í™•ì¸
curl http://localhost:8001/health

# ì˜ì¡´ì„± ì„œë²„ í™•ì¸
curl http://localhost:8002/health  # ISM
curl http://localhost:8003/api/v1/health  # PEM
curl http://localhost:8004/health  # Render
```

## ğŸ“ ë‹¤ìŒ ë‹¨ê³„

1. ISM/PEM ì„œë²„ í˜¸ì¶œ ê¸°ëŠ¥ ì™„ì „ êµ¬í˜„
2. Docker Compose íŒŒì¼ ìƒì„± ë° í†µí•©
3. ë°°ì¹˜ ì²˜ë¦¬ ë° ì—ëŸ¬ ë³µêµ¬ ê¸°ëŠ¥ ì¶”ê°€
4. ì„±ëŠ¥ ìµœì í™” ë° ëª¨ë‹ˆí„°ë§ ê°•í™”
