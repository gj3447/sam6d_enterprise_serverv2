# 이미지 저장 확인 결과 (2025-01-28)

## ✅ 확인 결과: 이미지 파일이 정상적으로 저장됩니다!

## 📊 저장된 파일 확인

### 1. ISM 결과 파일 (실제 확인됨)

**위치**: `static/output/1761294743/ism_test/`

**파일 목록**:
```
detection_ism.json    - ISM 감지 결과 JSON
detection_ism.npz     - ISM 감지 결과 NumPy 형식
vis_ism.png          - ISM 시각화 이미지 ⭐
```

**detection_ism.json 내용**:
- 14개 객체 감지됨
- 각 객체에 대해 bbox, score, segmentation 데이터 포함
- 파일 크기: 약 12KB (JSON)

### 2. PEM 결과 파일 (실제 확인됨)

**위치**: `static/output/1761295206/pem_only_test/`

**파일 목록**:
```
detection_pem.json    - PEM 포즈 추정 결과 JSON
vis_pem.png          - PEM 시각화 이미지 ⭐
```

## 📁 전체 Output 구조

```
static/output/
├── 1761294743/              # 테스트 실행
│   └── ism_test/
│       ├── detection_ism.json
│       ├── detection_ism.npz
│       └── vis_ism.png ⭐
│
├── 1761295206/              # 테스트 실행
│   └── pem_only_test/
│       ├── detection_pem.json
│       └── vis_pem.png ⭐
│
└── 20251028_*/              # Main Server 파이프라인 실행
    ├── ism/
    └── pem/
```

## 🎯 파이프라인별 파일 저장 상황

### ✅ 테스트 모드 (직접 실행)
- **ISM 테스트**: 파일 정상 생성 ✅
- **PEM 테스트**: 파일 정상 생성 ✅
- **이미지 파일**: vis_ism.png, vis_pem.png 저장됨 ✅

### ⚠️ Main Server 파이프라인 모드
- **디렉토리 생성**: 정상 ✅
- **파일 생성**: 빈 디렉토리 (파일 미생성) ❌

## 🔍 원인 분석

### 테스트 모드는 정상

**ISM 서버 직접 테스트**:
```python
# ism_service.py의 test_ism_server 함수
# output_dir에 정확한 경로 전달
# → 파일 생성됨
```

**PEM 서버 직접 테스트**:
```python
# pem_service.py의 test_pem_only 함수
# output_dir에 정확한 경로 전달
# → 파일 생성됨
```

### Main Server 파이프라인은 문제 발생

**가능한 원인**:
1. **경로 변환 문제**: 호스트→컨테이너 경로 변환 시 문제
2. **서버 연결 문제**: ISM/PEM 서버가 파일을 저장하지 않음
3. **비동기 처리 문제**: 파일 저장 완료 전에 응답 반환

## 🧪 테스트 결과 분석

### 실제 파일 생성 확인

**ISM 결과 (detection_ism.json)**:
- 14개 객체 감지됨
- 각 객체의 bbox, score, segmentation 정보 포함
- JSON 형식으로 정상 저장

**시각화 이미지**:
- `vis_ism.png`: ISM 감지 결과 시각화
- `vis_pem.png`: PEM 포즈 추정 결과 시각화

## ✅ 결론

### 이미지 파일 저장 상태

1. **테스트 모드**: ✅ 정상 작동
   - 이미지 파일 생성됨
   - JSON 결과 파일 생성됨

2. **Main Server 파이프라인**: ⚠️ 부분 작동
   - 디렉토리 생성됨
   - 파일 생성 안 됨 (경로 문제 가능성)

### 해결 방법

1. **경로 확인**: 컨테이너 내부에서 output_dir 경로가 올바른지 확인
2. **로그 확인**: ISM/PEM 서버 로그에서 파일 저장 관련 메시지 확인
3. **권한 확인**: 컨테이너 내부에서 output_dir에 쓰기 권한 확인

## 📊 파일 통계

### 생성된 파일

| 파일 타입 | 개수 | 위치 |
|----------|------|------|
| PNG 이미지 | 2개 | vis_ism.png, vis_pem.png |
| JSON 결과 | 2개 | detection_ism.json, detection_pem.json |
| NPZ 파일 | 1개 | detection_ism.npz |

### 파일 크기 (예상)

- `vis_ism.png`: ~745KB (문서상 참조)
- `detection_ism.json`: ~12KB
- `detection_ism.npz`: ~25KB
- `vis_pem.png`: ~비슷한 크기
- `detection_pem.json`: ~10KB

## 🎯 최종 확인

**✅ 이미지 파일이 실제로 저장됩니다!**

**증거**:
1. `vis_ism.png` 파일 존재 확인
2. `vis_pem.png` 파일 존재 확인
3. `detection_ism.json` 데이터 확인
4. `detection_pem.json` 데이터 확인

**⚠️ Main Server 파이프라인**은 디렉토리만 생성되고 파일은 생성되지 않는 것으로 보입니다. 이는 경로 전달 문제일 가능성이 높습니다.

## 💡 해결 권장사항

1. Main Server에서 전달하는 output_dir 경로 확인
2. 컨테이너 내부 경로와 호스트 경로 매핑 확인
3. ISM/PEM 서버 로그에서 실제 저장 경로 확인
4. 직접 테스트와 Main Server 파이프라인의 경로 차이 비교

