# Main_Server í˜„ì¬ êµ¬í˜„ ìƒíƒœ (2025-01-28)

## ğŸ“‹ ê°œìš”

Main_ServerëŠ” í¬íŠ¸ 8001ì—ì„œ ì‹¤í–‰ë˜ëŠ” ì¤‘ì•™ ê´€ë¦¬ ì„œë²„ë¡œ, ì „ì²´ ì‹œìŠ¤í…œì˜ ê°ì²´ ë°ì´í„°ë² ì´ìŠ¤ ê´€ë¦¬ì™€ ì›Œí¬í”Œë¡œìš° ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜ì„ ë‹´ë‹¹í•©ë‹ˆë‹¤.

## ğŸ“ í”„ë¡œì íŠ¸ êµ¬ì¡°

```
Estimation_Server/
â”œâ”€â”€ static/
â”‚   â”œâ”€â”€ meshes/          # CAD ëª¨ë¸ íŒŒì¼ (.ply)
â”‚   â”œâ”€â”€ templates/       # í…œí”Œë¦¿ íŒŒì¼ (mask, rgb, xyz)
â”‚   â”œâ”€â”€ output/          # ì¶”ë¡  ê²°ê³¼ ì¶œë ¥
â”‚   â””â”€â”€ test/            # í…ŒìŠ¤íŠ¸ ë°ì´í„° (rgb, depth, camera)
â””â”€â”€ Main_Server/
    â”œâ”€â”€ api/
    â”‚   â”œâ”€â”€ endpoints/   # API ì—”ë“œí¬ì¸íŠ¸
    â”‚   â””â”€â”€ models.py    # Pydantic ëª¨ë¸
    â”œâ”€â”€ services/
    â”‚   â”œâ”€â”€ scanner.py              # Static í´ë” ìŠ¤ìº”
    â”‚   â”œâ”€â”€ server_monitor.py       # ì„œë²„ ìƒíƒœ ëª¨ë‹ˆí„°ë§
    â”‚   â””â”€â”€ workflow_service.py     # ì›Œí¬í”Œë¡œìš° ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜
    â”œâ”€â”€ utils/
    â”‚   â”œâ”€â”€ file_utils.py   # íŒŒì¼ ìœ í‹¸ë¦¬í‹°
    â”‚   â””â”€â”€ path_utils.py   # ê²½ë¡œ ìœ í‹¸ë¦¬í‹°
    â””â”€â”€ main.py           # FastAPI ì• í”Œë¦¬ì¼€ì´ì…˜
```

## âœ… êµ¬í˜„ ì™„ë£Œëœ ê¸°ëŠ¥

### 1. ê°ì²´ ë°ì´í„°ë² ì´ìŠ¤ ê´€ë¦¬ (Object Database)

**íŒŒì¼**: `services/scanner.py`

**ê¸°ëŠ¥**:
- âœ… `scan_all_classes()`: ëª¨ë“  í´ë˜ìŠ¤ ìŠ¤ìº”
- âœ… `scan_class(class_name)`: íŠ¹ì • í´ë˜ìŠ¤ ìŠ¤ìº”
- âœ… `scan_object(class_name, object_name)`: íŠ¹ì • ê°ì²´ ìŠ¤ìº”
- âœ… `get_statistics()`: ì „ì²´ í†µê³„ ì •ë³´

**ì¶”ì  ì •ë³´**:
```python
{
    "name": "obj_000005",
    "cad_file": "obj_000005.ply",
    "cad_path": "static/meshes/test/obj_000005.ply",
    "cad_size_bytes": 1024000,
    "has_template": True,
    "template_files": {
        "mask_count": 42,
        "rgb_count": 42,
        "xyz_count": 42,
        "total_count": 126
    },
    "status": "ready"  # ë˜ëŠ” "needs_template"
}
```

### 2. ì„œë²„ ìƒíƒœ ëª¨ë‹ˆí„°ë§ (Server Monitoring)

**íŒŒì¼**: `services/server_monitor.py`

**ê¸°ëŠ¥**:
- âœ… `check_server_health(name, url)`: íŠ¹ì • ì„œë²„ í—¬ìŠ¤ ì²´í¬
- âœ… `check_all_servers()`: ëª¨ë“  ì„œë²„ ìƒíƒœ í™•ì¸

**ëª¨ë‹ˆí„°ë§ ì„œë²„**:
- ISM Server (í¬íŠ¸ 8002)
- PEM Server (í¬íŠ¸ 8003)
- Render Server (í¬íŠ¸ 8004)

### 3. ì›Œí¬í”Œë¡œìš° ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜ (Workflow Orchestration)

**íŒŒì¼**: `services/workflow_service.py`

**ê¸°ëŠ¥**:
- âœ… `render_templates()`: í…œí”Œë¦¿ ìƒì„± ì›Œí¬í”Œë¡œìš°
- âœ… `execute_full_pipeline()`: ì „ì²´ íŒŒì´í”„ë¼ì¸ ì‹¤í–‰ (Render â†’ ISM â†’ PEM)
- âœ… `_call_render_server()`: Render ì„œë²„ í˜¸ì¶œ
- âœ… `_call_ism_server()`: ISM ì„œë²„ í˜¸ì¶œ
- âœ… `_call_pem_server()`: PEM ì„œë²„ í˜¸ì¶œ

**íŒŒì´í”„ë¼ì¸ íë¦„**:
```
1. í…œí”Œë¦¿ í™•ì¸ â†’ ì—†ìœ¼ë©´ Render ì„œë²„ë¡œ ìƒì„±
2. ISM ì„œë²„ë¡œ ê°ì²´ ê°ì§€
3. PEM ì„œë²„ë¡œ í¬ì¦ˆ ì¶”ì •
4. ê²°ê³¼ë¥¼ static/output/{timestamp}/ ì €ì¥
```

### 4. API ì—”ë“œí¬ì¸íŠ¸

**íŒŒì¼**: `api/endpoints/*.py`

**ê°ì²´ ê´€ë¦¬ API**:
- âœ… `GET /api/v1/objects/classes`: ëª¨ë“  í´ë˜ìŠ¤ ëª©ë¡
- âœ… `GET /api/v1/objects/classes/{class_name}`: íŠ¹ì • í´ë˜ìŠ¤ì˜ ê°ì²´ ëª©ë¡
- âœ… `GET /api/v1/objects/{class_name}/{object_name}`: ê°ì²´ ìƒì„¸ ì •ë³´
- âœ… `POST /api/v1/objects/scan`: ê°ì²´ ì¬ìŠ¤ìº”

**ì„œë²„ ìƒíƒœ API**:
- âœ… `GET /api/v1/servers/status`: ëª¨ë“  ì„œë²„ ìƒíƒœ
- âœ… `GET /api/v1/servers/status/{server_name}`: íŠ¹ì • ì„œë²„ ìƒíƒœ

**ì›Œí¬í”Œë¡œìš° API**:
- âœ… `POST /api/v1/workflow/render-templates`: í…œí”Œë¦¿ ìƒì„±
- âœ… `POST /api/v1/workflow/render-templates-missing`: ì—†ëŠ” í…œí”Œë¦¿ë§Œ ìƒì„±
- âœ… `POST /api/v1/workflow/render-templates-all`: ëª¨ë“  í…œí”Œë¦¿ ìƒì„±
- âœ… `POST /api/v1/workflow/render-template-single`: ë‹¨ì¼ í…œí”Œë¦¿ ìƒì„±
- âœ… `POST /api/v1/workflow/full-pipeline`: ì „ì²´ íŒŒì´í”„ë¼ì¸ ì‹¤í–‰

### 5. ê²½ë¡œ ê´€ë¦¬

**íŒŒì¼**: `utils/path_utils.py`, `services/workflow_service.py`

**ê¸°ëŠ¥**:
- âœ… í˜¸ìŠ¤íŠ¸ ê²½ë¡œ â†’ ì»¨í…Œì´ë„ˆ ê²½ë¡œ ìë™ ë³€í™˜
- âœ… íƒ€ì„ìŠ¤íƒ¬í”„ ê¸°ë°˜ ì¶œë ¥ ë””ë ‰í† ë¦¬ ìë™ ìƒì„±
- âœ… ISM/PEM ì¶œë ¥ ë””ë ‰í† ë¦¬ ìë™ ìƒì„±

**ê²½ë¡œ êµ¬ì¡°**:
```
static/output/{timestamp}/
â”œâ”€â”€ ism/
â”‚   â””â”€â”€ detection_ism.json
â””â”€â”€ pem/
    â””â”€â”€ pose_estimation.json
```

## ğŸ“Š êµ¬í˜„ ìƒíƒœ ìš”ì•½

### ì™„ë£Œëœ ê¸°ëŠ¥ âœ…
1. **ê°ì²´ ë°ì´í„°ë² ì´ìŠ¤ ê´€ë¦¬**: 100%
2. **ì„œë²„ ìƒíƒœ ëª¨ë‹ˆí„°ë§**: 100%
3. **ì›Œí¬í”Œë¡œìš° ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜**: 100%
4. **API ì—”ë“œí¬ì¸íŠ¸**: 100%
5. **ê²½ë¡œ ê´€ë¦¬**: 100%

### í•µì‹¬ ì»´í¬ë„ŒíŠ¸

| ì»´í¬ë„ŒíŠ¸ | íŒŒì¼ | ìƒíƒœ |
|---------|------|------|
| Scanner | `services/scanner.py` | âœ… ì™„ë£Œ |
| Server Monitor | `services/server_monitor.py` | âœ… ì™„ë£Œ |
| Workflow Service | `services/workflow_service.py` | âœ… ì™„ë£Œ |
| API Endpoints | `api/endpoints/*.py` | âœ… ì™„ë£Œ |
| Models | `api/models.py` | âœ… ì™„ë£Œ |
| Utils | `utils/*.py` | âœ… ì™„ë£Œ |

## ğŸ”§ ê¸°ìˆ  ìŠ¤íƒ

- **ì›¹ í”„ë ˆì„ì›Œí¬**: FastAPI
- **ë¹„ë™ê¸° ì²˜ë¦¬**: asyncio
- **HTTP í´ë¼ì´ì–¸íŠ¸**: httpx, requests
- **ë°ì´í„° ê²€ì¦**: Pydantic
- **ê²½ë¡œ ê´€ë¦¬**: pathlib

## ğŸ“ ë‹¤ìŒ ë‹¨ê³„

1. í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ë° ê²€ì¦
2. API ë¬¸ì„œ í™•ì¸ (Swagger UI: http://localhost:8001/docs)
3. ì‹¤ì œ íŒŒì´í”„ë¼ì¸ ì‹¤í–‰ í…ŒìŠ¤íŠ¸

## ğŸ¯ ì°¸ê³  ì‚¬í•­

- ì„œë²„ëŠ” í¬íŠ¸ 8001ì—ì„œ ì‹¤í–‰ë©ë‹ˆë‹¤
- ì‹¤ì‹œê°„ìœ¼ë¡œ static í´ë”ë¥¼ ìŠ¤ìº”í•©ë‹ˆë‹¤ (ë°ì´í„°ë² ì´ìŠ¤ ì—†ìŒ)
- ëª¨ë“  ê²½ë¡œëŠ” í˜¸ìŠ¤íŠ¸ì—ì„œ ì»¨í…Œì´ë„ˆë¡œ ìë™ ë³€í™˜ë©ë‹ˆë‹¤

