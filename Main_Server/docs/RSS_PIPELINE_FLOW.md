# RSS íŒŒì´í”„ë¼ì¸ ì‹¤í–‰ íë¦„ ê°€ì´ë“œ

## ğŸ“‹ ê°œìš”

RSS (RealSense Stream) íŒŒì´í”„ë¼ì¸ì€ RealSense ì¹´ë©”ë¼ì—ì„œ ì§ì ‘ RGB-D ì´ë¯¸ì§€ë¥¼ ìˆ˜ì§‘í•˜ì—¬ ê°ì²´ ì¸ì‹ ë° 6D í¬ì¦ˆ ì¶”ì •ì„ ìˆ˜í–‰í•˜ëŠ” ì „ì²´ ì›Œí¬í”Œë¡œìš°ì…ë‹ˆë‹¤.

**API ì—”ë“œí¬ì¸íŠ¸**: `POST /api/v1/workflow/full-pipeline-from-rss`

---

## ğŸ”„ ì „ì²´ íŒŒì´í”„ë¼ì¸ íë¦„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. API ìš”ì²­ ìˆ˜ì‹                                                 â”‚
â”‚    POST /api/v1/workflow/full-pipeline-from-rss               â”‚
â”‚    { class_name, object_name, base/host/port, ... }            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. RSS ì„œë²„ì—ì„œ ë°ì´í„° ìˆ˜ì§‘                                     â”‚
â”‚    â”œâ”€ GET /camera/calibration                                  â”‚
â”‚    â”œâ”€ GET /camera/status                                       â”‚
â”‚    â”œâ”€ GET /streams/color_jpeg                                  â”‚
â”‚    â”œâ”€ GET /streams/color_raw                                   â”‚
â”‚    â””â”€ GET /streams/depth_raw                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. ì´ë¯¸ì§€ ì²˜ë¦¬ ë° ì •í•©                                          â”‚
â”‚    â”œâ”€ Color JPEG â†’ PNG ë³€í™˜                                    â”‚
â”‚    â”œâ”€ Color Raw â†’ RGB ë°°ì—´ ë³€í™˜                                â”‚
â”‚    â”œâ”€ Depth Raw â†’ Depth ë°°ì—´ ë³€í™˜                              â”‚
â”‚    â””â”€ [align_color=true] Depth â†’ Color í”„ë ˆì„ ì •í•©            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. ì¹´ë©”ë¼ íŒŒë¼ë¯¸í„° êµ¬ì„±                                        â”‚
â”‚    â”œâ”€ cam_K (intrinsics) ì¶”ì¶œ                                  â”‚
â”‚    â”œâ”€ depth_scale ì¶”ì¶œ                                         â”‚
â”‚    â””â”€ extrinsics (T_d2c) ì¶”ì¶œ (ì •í•©ìš©)                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. execute_full_pipeline í˜¸ì¶œ                                  â”‚
â”‚    (RGB/Depth Base64 + cam_params ì „ë‹¬)                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                â”‚                â”‚
        â–¼                â–¼                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 1:     â”‚ â”‚ Step 2:      â”‚ â”‚ Step 3:      â”‚
â”‚ Render      â”‚ â”‚ ISM           â”‚ â”‚ PEM          â”‚
â”‚ Templates   â”‚ â”‚ Segmentation  â”‚ â”‚ Pose Est.    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                â”‚                â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. ê²°ê³¼ í†µí•© ë° ì €ì¥                                            â”‚
â”‚    â”œâ”€ í¬ì¦ˆ ê²°ê³¼ ìš”ì•½ (pose_results)                            â”‚
â”‚    â”œâ”€ ë©”íƒ€ë°ì´í„° ì €ì¥ (pipeline_metadata.json)                 â”‚
â”‚    â””â”€ ISM/PEM ê²°ê³¼ ì €ì¥ (output_modeì— ë”°ë¼)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 7. ì‘ë‹µ ë°˜í™˜                                                    â”‚
â”‚    {                                                           â”‚
â”‚      success: true,                                            â”‚
â”‚      results: {                                                â”‚
â”‚        pose_results: [...],                                     â”‚
â”‚        num_poses: N,                                            â”‚
â”‚        output_dir: "..."                                        â”‚
â”‚      }                                                         â”‚
â”‚    }                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ ë‹¨ê³„ë³„ ìƒì„¸ ì„¤ëª…

### ë‹¨ê³„ 1: API ìš”ì²­ ìˆ˜ì‹ 

**ì—”ë“œí¬ì¸íŠ¸**: `POST /api/v1/workflow/full-pipeline-from-rss`

**ìš”ì²­ íŒŒë¼ë¯¸í„°**:
```json
{
  "class_name": "ycb",           // í•„ìˆ˜: ê°ì²´ í´ë˜ìŠ¤
  "object_name": "obj_000002",   // í•„ìˆ˜: ê°ì²´ ì´ë¦„
  "base": "http://192.168.0.197:51000",  // RSS ì„œë²„ URL (ì„ íƒ)
  "host": "192.168.0.197",       // RSS ì„œë²„ í˜¸ìŠ¤íŠ¸ (base ì—†ì„ ë•Œ)
  "port": 51000,                 // RSS ì„œë²„ í¬íŠ¸ (base ì—†ì„ ë•Œ)
  "align_color": true,           // Depth ì •í•© ì—¬ë¶€
  "frame_guess": false,          // ì¹´ë©”ë¼ í”„ë ˆì„ ìœ ì¶”
  "output_mode": "full"          // ì¶œë ¥ ëª¨ë“œ: full/results_only/none
}
```

**ì²˜ë¦¬ ìœ„ì¹˜**: `Main_Server/api/endpoints/workflow.py::execute_full_pipeline_from_rss`

---

### ë‹¨ê³„ 2: RSS ì„œë²„ì—ì„œ ë°ì´í„° ìˆ˜ì§‘

**í•¨ìˆ˜**: `WorkflowService.execute_full_pipeline_from_rss()`

**ìˆ˜ì§‘ í•­ëª©**:

1. **Calibration ë°ì´í„°** (`/camera/calibration`)
   - ì¹´ë©”ë¼ ë‚´ë¶€ íŒŒë¼ë¯¸í„° (intrinsics)
   - Depth scale
   - ì™¸ë¶€ íŒŒë¼ë¯¸í„° (extrinsics)

2. **Status ë°ì´í„°** (`/camera/status`)
   - ì¹´ë©”ë¼ ìƒíƒœ ì •ë³´
   - ë³´ì¡° íŒŒë¼ë¯¸í„° (calibration ì—†ì„ ë•Œ ëŒ€ì²´)

3. **Color JPEG** (`/streams/color_jpeg`)
   - ì••ì¶•ëœ ì»¬ëŸ¬ ì´ë¯¸ì§€ (í¬ê¸° í™•ì¸ìš©)

4. **Color Raw** (`/streams/color_raw`)
   - ì›ë³¸ RGB ë°”ì´íŠ¸ ìŠ¤íŠ¸ë¦¼ (W Ã— H Ã— 3 bytes)
   - RGB â†’ PNG ë³€í™˜

5. **Depth Raw** (`/streams/depth_raw`)
   - ì›ë³¸ Depth ë°”ì´íŠ¸ ìŠ¤íŠ¸ë¦¼ (W Ã— H Ã— 2 bytes, uint16)
   - Depth â†’ PNG ë³€í™˜

**ë¡œê·¸ ì¶œë ¥**:
```
[RSS] >>> begin execute_from_rss at ...
[RSS] base_url=...
[RSS] fetch calibration/status ...
[RSS] calibration/status fetched
[RSS] fetch color_jpeg ...
[RSS] fetch color_raw ...
[RSS] fetch depth_raw ...
```

**ì²˜ë¦¬ ìœ„ì¹˜**: `Main_Server/services/workflow_service.py::execute_full_pipeline_from_rss` (850-974ì¤„)

---

### ë‹¨ê³„ 3: ì´ë¯¸ì§€ ì²˜ë¦¬ ë° ì •í•©

**ì²˜ë¦¬ ê³¼ì •**:

1. **Color ì²˜ë¦¬**:
   ```python
   color_raw â†’ numpy array (H, W, 3) â†’ RGB ë³€í™˜ â†’ PNG â†’ Base64
   ```

2. **Depth ì²˜ë¦¬**:
   ```python
   depth_raw â†’ numpy array (H, W) uint16 â†’ PNG â†’ Base64
   ```

3. **Depth ì •í•©** (align_color=trueì¼ ë•Œ):
   ```
   Depth í”„ë ˆì„ â†’ 3D í¬ì¸íŠ¸ í´ë¼ìš°ë“œ ë³€í™˜
   â†’ Extrinsics ì ìš© (T_d2c)
   â†’ Color í”„ë ˆì„ì— ì¬íˆ¬ì˜
   â†’ ì •í•©ëœ Depth ìƒì„±
   ```

**ë¡œê·¸ ì¶œë ¥**:
```
[RSS] color size W=640 H=480
[RSS] color prepared
[RSS] depth prepared (raw)
```

**ì²˜ë¦¬ ìœ„ì¹˜**: `Main_Server/services/workflow_service.py::execute_full_pipeline_from_rss` (901-973ì¤„)

---

### ë‹¨ê³„ 4: ì¹´ë©”ë¼ íŒŒë¼ë¯¸í„° êµ¬ì„±

**ì¶”ì¶œ í•­ëª©**:

1. **cam_K** (ì¹´ë©”ë¼ ë‚´ë¶€ íŒŒë¼ë¯¸í„°):
   ```python
   camK = [[fx,  0, cx],
           [ 0, fy, cy],
           [ 0,  0,  1]]
   ```
   - Color ë˜ëŠ” Depth intrinsics ì‚¬ìš©
   - `align_color=true`ë©´ Color intrinsics ìš°ì„ 

2. **depth_scale**:
   - Calibration ë˜ëŠ” Statusì—ì„œ ì¶”ì¶œ
   - ê¸°ë³¸ê°’: 1.0

3. **extrinsics** (T_d2c):
   - Depth â†’ Color ë³€í™˜ í–‰ë ¬ (4Ã—4)
   - ì •í•©ì— í•„ìš”

**ìµœì¢… cam_params**:
```python
{
  'cam_K': [fx, 0, cx, 0, fy, cy, 0, 0, 1],  # 9ê°œ ê°’ (flattened)
  'depth_scale': 1000.0
}
```

**ë¡œê·¸ ì¶œë ¥**:
```
[RSS] depth_scale=1000.0 camK_depth=ok camK_color=ok
[RSS] extrinsics(depth->color)=ok
[RSS] cam_params prepared
```

**ì²˜ë¦¬ ìœ„ì¹˜**: `Main_Server/services/workflow_service.py::execute_full_pipeline_from_rss` (869-899ì¤„)

---

### ë‹¨ê³„ 5: execute_full_pipeline í˜¸ì¶œ

**í•¨ìˆ˜**: `WorkflowService.execute_full_pipeline()`

**ì „ë‹¬ íŒŒë¼ë¯¸í„°**:
- `rgb_image`: Base64 ì¸ì½”ë”©ëœ RGB ì´ë¯¸ì§€
- `depth_image`: Base64 ì¸ì½”ë”©ëœ Depth ì´ë¯¸ì§€
- `cam_params`: ì¹´ë©”ë¼ íŒŒë¼ë¯¸í„° ë”•ì…”ë„ˆë¦¬
- `class_name`, `object_name`: ê°ì²´ ì •ë³´
- `output_dir`: ì¶œë ¥ ë””ë ‰í† ë¦¬ (ìë™ ìƒì„± ë˜ëŠ” ì§€ì •)
- `output_mode`: ì¶œë ¥ ëª¨ë“œ

**ì²˜ë¦¬ ìœ„ì¹˜**: `Main_Server/services/workflow_service.py::execute_full_pipeline` (141-318ì¤„)

---

### ë‹¨ê³„ 5-1: í…œí”Œë¦¿ ìƒì„± (Render Server)

**ì¡°ê±´**: í…œí”Œë¦¿ ë””ë ‰í† ë¦¬ê°€ ì—†ì„ ë•Œë§Œ ì‹¤í–‰

**í”„ë¡œì„¸ìŠ¤**:
```
CAD íŒŒì¼ (.ply/.obj/.stl) â†’ Render Server í˜¸ì¶œ
â†’ 42ê°œ ê´€ì  ë Œë”ë§ (RGB, Mask, Point Cloud)
â†’ static/templates/{class}/{object}/ ì €ì¥
```

**ì„œë²„**: `Render_Server` (í¬íŠ¸ 8004)

**API**: `POST /render/templates`

**ë¡œê·¸ ì¶œë ¥**:
```
[INFO] Step 1: Rendering templates...
[INFO] Template already exists, skipping render step
```

**ì²˜ë¦¬ ìœ„ì¹˜**: `Main_Server/services/workflow_service.py::execute_full_pipeline` (211-221ì¤„)

---

### ë‹¨ê³„ 5-2: ê°ì²´ ê°ì§€ (ISM Server)

**í”„ë¡œì„¸ìŠ¤**:
```
RGB/Depth ì´ë¯¸ì§€ + í…œí”Œë¦¿ + CAD ëª¨ë¸
â†’ ISM Server í˜¸ì¶œ
â†’ ê°ì²´ ë§ˆìŠ¤í¬, ë°”ìš´ë”© ë°•ìŠ¤, íƒì§€ ì ìˆ˜ ìƒì„±
```

**ì„œë²„**: `ISM_Server` (í¬íŠ¸ 8002)

**API**: `POST /api/v1/inference`

**ìš”ì²­ ë°ì´í„°**:
```json
{
  "rgb_image": "<base64>",
  "depth_image": "<base64>",
  "cam_params": {
    "cam_K": [...],
    "depth_scale": 1000.0
  },
  "template_dir": "/workspace/.../templates/ycb/obj_000002",
  "cad_path": "/workspace/.../meshes/ycb/obj_000002.obj",
  "output_dir": "/workspace/.../output/.../ism"
}
```

**ì‘ë‹µ ë°ì´í„°**:
```json
{
  "success": true,
  "detections": {
    "masks": [...],
    "boxes": [...],
    "scores": [...],
    "object_ids": [...]
  },
  "inference_time": 160.088
}
```

**ëª¨ë‹ˆí„°ë§**:
- ìš”ì²­ ì „: í—¬ìŠ¤ ì²´í¬
- ì§„í–‰ ì¤‘: 30ì´ˆ, 1ë¶„, 2ë¶„, 3ë¶„, 5ë¶„ë§ˆë‹¤ ì§„í–‰ ìƒí™© ë¡œê·¸
- ì™„ë£Œ í›„: íƒì§€ëœ ê°ì²´ ìˆ˜ ì¶œë ¥

**ë¡œê·¸ ì¶œë ¥**:
```
[INFO] Step 2: Running ISM inference...
[INFO] ISM ì„œë²„ í˜¸ì¶œ ì‹œì‘
[INFO] ISM ì„œë²„ í—¬ìŠ¤ ì²´í¬: OK
[INFO] ISM ì„œë²„ì— ìš”ì²­ ì „ì†¡ ì¤‘... (íƒ€ì„ì•„ì›ƒ: 600ì´ˆ)
[INFO] ISM ì„œë²„ ìš”ì²­ ì§„í–‰ ì¤‘... (ê²½ê³¼: 30ì´ˆ, ë‚¨ì€ ì‹œê°„: 570ì´ˆ)
[INFO] ISM ì„œë²„ ì‘ë‹µ ìˆ˜ì‹  ì™„ë£Œ (ì†Œìš” ì‹œê°„: 160.09ì´ˆ)
[INFO] ISM ì¶”ë¡  ì™„ë£Œ: 152ê°œ ê°ì²´ íƒì§€
```

**ì²˜ë¦¬ ìœ„ì¹˜**: `Main_Server/services/workflow_service.py::_call_ism_server` (396-528ì¤„)

---

### ë‹¨ê³„ 5-3: í¬ì¦ˆ ì¶”ì • (PEM Server)

**í”„ë¡œì„¸ìŠ¤**:
```
ISM ê²°ê³¼ + RGB/Depth ì´ë¯¸ì§€ + í…œí”Œë¦¿ + CAD ëª¨ë¸
â†’ PEM Server í˜¸ì¶œ
â†’ 6D í¬ì¦ˆ ì¶”ì • (íšŒì „, ë³€ìœ„, ì ìˆ˜)
```

**ì„œë²„**: `PEM_Server` (í¬íŠ¸ 8003)

**API**: `POST /api/v1/pose-estimation`

**ìš”ì²­ ë°ì´í„°**:
```json
{
  "rgb_image": "<base64>",
  "depth_image": "<base64>",
  "cam_params": {...},
  "cad_path": "...",
  "template_dir": "...",
  "seg_data": [
    {
      "bbox": [x1, y1, x2, y2],
      "score": 0.95,
      "segmentation": {...}
    }
  ],
  "det_score_thresh": 0.2,
  "output_dir": "..."
}
```

**ì‘ë‹µ ë°ì´í„°**:
```json
{
  "success": true,
  "poses": [
    {
      "translation": [x, y, z],
      "rotation": [[...], [...], [...]],
      "score": 0.0811
    }
  ]
}
```

**ëª¨ë‹ˆí„°ë§**:
- ìš”ì²­ ì „: í—¬ìŠ¤ ì²´í¬
- ì§„í–‰ ì¤‘: 30ì´ˆ, 1ë¶„, 2ë¶„, 3ë¶„, 5ë¶„ë§ˆë‹¤ ì§„í–‰ ìƒí™© ë¡œê·¸
- ì™„ë£Œ í›„: ì¶”ì •ëœ í¬ì¦ˆ ìˆ˜ ë° ì ìˆ˜ ë²”ìœ„ ì¶œë ¥

**ë¡œê·¸ ì¶œë ¥**:
```
[INFO] Step 3: Running PEM inference...
[INFO] PEM ì„œë²„ í˜¸ì¶œ ì‹œì‘
[INFO] PEM ì„œë²„ í—¬ìŠ¤ ì²´í¬: OK
[INFO] PEM ì„œë²„ì— ìš”ì²­ ì „ì†¡ ì¤‘... (íƒ€ì„ì•„ì›ƒ: 900ì´ˆ)
[INFO] PEM ì„œë²„ ìš”ì²­ ì§„í–‰ ì¤‘... (ê²½ê³¼: 60ì´ˆ, ë‚¨ì€ ì‹œê°„: 840ì´ˆ)
[INFO] PEM ì„œë²„ ì‘ë‹µ ìˆ˜ì‹  ì™„ë£Œ (ì†Œìš” ì‹œê°„: 85.23ì´ˆ)
[INFO] PEM ì¶”ë¡  ì™„ë£Œ: 5ê°œ í¬ì¦ˆ ì¶”ì •
[INFO] í¬ì¦ˆ ì ìˆ˜ ë²”ìœ„: 0.0811 ~ 0.2456
```

**ì²˜ë¦¬ ìœ„ì¹˜**: `Main_Server/services/workflow_service.py::_call_pem_server` (530-684ì¤„)

---

### ë‹¨ê³„ 6: ê²°ê³¼ í†µí•© ë° ì €ì¥

**ì €ì¥ í•­ëª©** (output_modeì— ë”°ë¼):

#### `output_mode="full"` (ì „ì²´ ì €ì¥)
```
static/output/20251104_145517_api-full-pipeline-from-rss/
â”œâ”€â”€ camera_params.json          # ì¹´ë©”ë¼ íŒŒë¼ë¯¸í„°
â”œâ”€â”€ input_rgb.png               # ì…ë ¥ RGB ì´ë¯¸ì§€
â”œâ”€â”€ input_depth.png             # ì…ë ¥ Depth ì´ë¯¸ì§€
â”œâ”€â”€ pipeline_metadata.json      # íŒŒì´í”„ë¼ì¸ ë©”íƒ€ë°ì´í„°
â”œâ”€â”€ ism/
â”‚   â”œâ”€â”€ detection_ism.json      # ISM íƒì§€ ê²°ê³¼
â”‚   â””â”€â”€ vis_ism.png             # ISM ì‹œê°í™”
â”œâ”€â”€ pem/
â”‚   â”œâ”€â”€ detection_pem.json     # PEM í¬ì¦ˆ ê²°ê³¼
â”‚   â””â”€â”€ vis_pem.png             # PEM ì‹œê°í™”
â”œâ”€â”€ ism_server_response.json    # ISM ì„œë²„ ì›ë³¸ ì‘ë‹µ
â””â”€â”€ pem_server_response.json   # PEM ì„œë²„ ì›ë³¸ ì‘ë‹µ
```

#### `output_mode="results_only"` (ìš”ì•½ë§Œ ì €ì¥)
```
static/output/20251104_145517_api-full-pipeline-from-rss/
â””â”€â”€ pose_results.json           # í¬ì¦ˆ ê²°ê³¼ ìš”ì•½
```

#### `output_mode="none"` (ì €ì¥ ì•ˆ í•¨)
- íŒŒì¼ ì €ì¥ ì—†ìŒ, ì‘ë‹µë§Œ ë°˜í™˜

**ì²˜ë¦¬ ìœ„ì¹˜**: `Main_Server/services/workflow_service.py::execute_full_pipeline` (256-283ì¤„)

---

### ë‹¨ê³„ 7: ì‘ë‹µ ë°˜í™˜

**ì‘ë‹µ í˜•ì‹**:
```json
{
  "success": true,
  "message": "Pipeline execution completed",
  "results": {
    "pose_results": [
      {
        "index": 0,
        "score": 0.0811,
        "rotation": [[...], [...], [...]],
        "translation": [185.77, -156.90, 950.11]
      }
    ],
    "num_poses": 5,
    "output_dir": "C:\\CD\\PROJECT\\BINPICKING\\Estimation_Server\\static\\output\\20251104_145517_api-full-pipeline-from-rss",
    "request_tag": "api-full-pipeline-from-rss"
  }
}
```

**ì‹¤íŒ¨ ì‹œ**:
```json
{
  "success": false,
  "message": "Pipeline execution failed",
  "results": {
    "error": "ì—ëŸ¬ ë©”ì‹œì§€",
    "pose_results": [],
    "num_poses": 0,
    "output_dir": null
  }
}
```

---

## ğŸ” ëª¨ë‹ˆí„°ë§ ê¸°ëŠ¥

### 1. ì„œë²„ í—¬ìŠ¤ ì²´í¬
- **ISM ì„œë²„**: ìš”ì²­ ì „ `http://localhost:8002/health` í™•ì¸
- **PEM ì„œë²„**: ìš”ì²­ ì „ `http://localhost:8003/api/v1/health` í™•ì¸
- ì‹¤íŒ¨ ì‹œ ê²½ê³  ì¶œë ¥í•˜ì§€ë§Œ ìš”ì²­ì€ ê³„ì† ì§„í–‰

### 2. ì§„í–‰ ìƒí™© ëª¨ë‹ˆí„°ë§
- **ì£¼ê¸°**: 10ì´ˆë§ˆë‹¤ ì²´í¬
- **ê²½ê³  ì‹œì **: 30ì´ˆ, 1ë¶„, 2ë¶„, 3ë¶„, 5ë¶„ ê²½ê³¼ ì‹œ
- **íƒ€ì„ì•„ì›ƒ ê²½ê³ **: íƒ€ì„ì•„ì›ƒ 60ì´ˆ ì „ ê²½ê³ 

**ë¡œê·¸ ì˜ˆì‹œ**:
```
[INFO] ISM ì„œë²„ ìš”ì²­ ì§„í–‰ ì¤‘... (ê²½ê³¼: 30ì´ˆ, ë‚¨ì€ ì‹œê°„: 570ì´ˆ)
[INFO] ISM ì„œë²„ ìš”ì²­ ì§„í–‰ ì¤‘... (ê²½ê³¼: 60ì´ˆ, ë‚¨ì€ ì‹œê°„: 540ì´ˆ)
[WARN] ISM ì„œë²„ íƒ€ì„ì•„ì›ƒ ì„ë°•! (ë‚¨ì€ ì‹œê°„: 60ì´ˆ)
```

### 3. ìƒì„¸ ì—ëŸ¬ ë¡œê¹…
- **íƒ€ì„ì•„ì›ƒ**: ì†Œìš” ì‹œê°„ê³¼ í•¨ê»˜ ì—ëŸ¬ ë©”ì‹œì§€
- **ì—°ê²° ì˜¤ë¥˜**: ì—°ê²° ì‹¤íŒ¨ ì‹œì ê³¼ ì›ì¸
- **HTTP ì˜¤ë¥˜**: ìƒíƒœ ì½”ë“œì™€ ì‘ë‹µ ë³¸ë¬¸ ì¼ë¶€
- **ì˜ˆì™¸**: ì „ì²´ ìŠ¤íƒ íŠ¸ë ˆì´ìŠ¤ í¬í•¨

**ì—ëŸ¬ ë¡œê·¸ ì˜ˆì‹œ**:
```
[ERROR] ISM Server timeout after 600.00ì´ˆ: ...
[ERROR] ISM Server connection error after 5.23ì´ˆ: ...
[ERROR] ISM Server HTTP error after 10.45ì´ˆ: HTTP 500 - ...
[ERROR] ISM Server unexpected error after 45.67ì´ˆ: ...
[ERROR] Traceback: ...
```

---

## â±ï¸ ì˜ˆìƒ ì†Œìš” ì‹œê°„

| ë‹¨ê³„ | ì˜ˆìƒ ì‹œê°„ | ë¹„ê³  |
|------|----------|------|
| RSS ë°ì´í„° ìˆ˜ì§‘ | 1-3ì´ˆ | ë„¤íŠ¸ì›Œí¬ ìƒíƒœì— ë”°ë¼ |
| ì´ë¯¸ì§€ ì²˜ë¦¬ ë° ì •í•© | 0.5-2ì´ˆ | align_color ì˜µì…˜ì— ë”°ë¼ |
| í…œí”Œë¦¿ ìƒì„± (Render) | 30-60ì´ˆ | í…œí”Œë¦¿ ì—†ì„ ë•Œë§Œ |
| ISM ì¶”ë¡  | 20-180ì´ˆ | ê°ì²´ ìˆ˜ì™€ ë³µì¡ë„ì— ë”°ë¼ |
| PEM ì¶”ë¡  | 30-120ì´ˆ | íƒì§€ëœ ê°ì²´ ìˆ˜ì— ë”°ë¼ |
| **ì „ì²´** | **1-5ë¶„** | ì¼ë°˜ì ì¸ ê²½ìš° |

---

## ğŸš¨ ì—ëŸ¬ ì²˜ë¦¬ ë° íƒ€ì„ì•„ì›ƒ

### íƒ€ì„ì•„ì›ƒ ì„¤ì •
- **ISM ì„œë²„**: 600ì´ˆ (10ë¶„)
- **PEM ì„œë²„**: 900ì´ˆ (15ë¶„)
- **Render ì„œë²„**: 3720ì´ˆ (62ë¶„)
- **RSS ë°ì´í„° ìˆ˜ì§‘**: 10ì´ˆ (ìŠ¤íŠ¸ë¦¼ë³„)

### ì—ëŸ¬ ë°œìƒ ì‹œ
1. **ì¦‰ì‹œ ì—ëŸ¬ ë¡œê·¸ ì¶œë ¥**
2. **ë¶€ë¶„ ê²°ê³¼ ì €ì¥** (ê°€ëŠ¥í•œ ê²½ìš°)
3. **ìƒì„¸ ì—ëŸ¬ ë©”ì‹œì§€ ë°˜í™˜**
4. **ìŠ¤íƒ íŠ¸ë ˆì´ìŠ¤ ê¸°ë¡** (ì˜ˆì™¸ ë°œìƒ ì‹œ)

---

## ğŸ“Š ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§

### ë¡œê·¸ì—ì„œ í™•ì¸ ê°€ëŠ¥í•œ ì •ë³´
- ê° ë‹¨ê³„ë³„ ì†Œìš” ì‹œê°„
- ì„œë²„ ì‘ë‹µ ì‹œê°„
- íƒì§€ëœ ê°ì²´ ìˆ˜
- ì¶”ì •ëœ í¬ì¦ˆ ìˆ˜ ë° ì ìˆ˜ ë²”ìœ„
- íƒ€ì„ì•„ì›ƒ ê²½ê³ 

### ê°œì„  ê°€ëŠ¥í•œ ì§€ì 
- ISM/PEM ì„œë²„ í˜¸ì¶œì´ ì˜¤ë˜ ê±¸ë¦´ ê²½ìš°:
  - í…œí”Œë¦¿ ìºì‹œ í™•ì¸ (ì‚¬ì „ ë¡œë”© ì—¬ë¶€)
  - GPU ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ í™•ì¸
  - ISM ì„œë²„ ë¡œê·¸ í™•ì¸ (`ISM_Server/log/*.log`)

---

## ğŸ”— ê´€ë ¨ íŒŒì¼

- **API ì—”ë“œí¬ì¸íŠ¸**: `Main_Server/api/endpoints/workflow.py`
- **ì„œë¹„ìŠ¤ ë¡œì§**: `Main_Server/services/workflow_service.py`
  - `execute_full_pipeline_from_rss()`: RSS ë°ì´í„° ìˆ˜ì§‘ ë° ì „ì²˜ë¦¬
  - `execute_full_pipeline()`: ì „ì²´ íŒŒì´í”„ë¼ì¸ ì‹¤í–‰
  - `_call_ism_server()`: ISM ì„œë²„ í˜¸ì¶œ (ëª¨ë‹ˆí„°ë§ í¬í•¨)
  - `_call_pem_server()`: PEM ì„œë²„ í˜¸ì¶œ (ëª¨ë‹ˆí„°ë§ í¬í•¨)
- **API ëª¨ë¸**: `Main_Server/api/models.py` (`RssFullPipelineRequest`)
- **ê¸°ì¡´ ë¬¸ì„œ**: `Main_Server/docs/RSS_API_GUIDE.md`

---

## ğŸ“ ì£¼ì˜ì‚¬í•­

1. **ë„¤íŠ¸ì›Œí¬ ìƒíƒœ**: RSS ì„œë²„ ì—°ê²°ì´ ë¶ˆì•ˆì •í•˜ë©´ ìŠ¤íŠ¸ë¦¼ ìˆ˜ì§‘ ë‹¨ê³„ì—ì„œ ì‹¤íŒ¨í•  ìˆ˜ ìˆìŒ
2. **ë©”ëª¨ë¦¬ ì‚¬ìš©**: í° ì´ë¯¸ì§€ë‚˜ ë§ì€ ê°ì²´ íƒì§€ ì‹œ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ì¦ê°€
3. **íƒ€ì„ì•„ì›ƒ**: ê¸°ë³¸ íƒ€ì„ì•„ì›ƒì€ ì¶©ë¶„íˆ ê¸¸ì§€ë§Œ, ë§¤ìš° ë³µì¡í•œ ì¥ë©´ì—ì„œëŠ” ì´ˆê³¼í•  ìˆ˜ ìˆìŒ
4. **ì¶œë ¥ ë””ë ‰í† ë¦¬**: `output_mode="full"`ì¼ ë•Œ ë””ìŠ¤í¬ ê³µê°„ í™•ì¸ í•„ìš”

---

**ìµœì¢… ì—…ë°ì´íŠ¸**: 2025-11-04
**ë¬¸ì„œ ë²„ì „**: 2.0 (ëª¨ë‹ˆí„°ë§ ê¸°ëŠ¥ ì¶”ê°€)

