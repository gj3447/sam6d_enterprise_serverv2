# ì¶”ë¡  ì…ë ¥ê°’ ë¹„êµ: í˜„ì¬ vs ì´ìƒì 

## ğŸ¯ ì‚¬ìš©ìê°€ ì›í•˜ëŠ” ì…ë ¥ê°’

```python
{
    "rgb_image": "...",           # RGB ì´ë¯¸ì§€ (base64)
    "depth_image": "...",          # Depth ì´ë¯¸ì§€ (base64)
    "camera_calibration": {...},   # ì¹´ë©”ë¼ ìº˜ë¦¬ë¸Œë ˆì´ì…˜
    "class_name": "lm",            # í´ë˜ìŠ¤ ì´ë¦„
    "mesh_name": "obj_000001"      # ë©”ì‰¬ ì´ë¦„
}
```

**í•µì‹¬**: ë©”ì‰¬ ê²½ë¡œ, í…œí”Œë¦¿ ê²½ë¡œëŠ” **ìë™ ê³„ì‚°**ë˜ì–´ì•¼ í•¨

---

## ğŸ“‹ í˜„ì¬ ì„œë²„ ì…ë ¥ê°’

### 1. **ISM_Server** (`ISM_Server/main.py:102`)

```python
class InferenceRequest(BaseModel):
    rgb_image: str          # âœ… Base64 RGB ì´ë¯¸ì§€
    depth_image: str        # âœ… Base64 Depth ì´ë¯¸ì§€
    cam_params: dict        # âœ… ì¹´ë©”ë¼ íŒŒë¼ë¯¸í„°
    template_dir: str       # âŒ í…œí”Œë¦¿ ë””ë ‰í† ë¦¬ ê²½ë¡œ (ìˆ˜ë™ ì§€ì •)
    cad_path: str           # âŒ CAD íŒŒì¼ ê²½ë¡œ (ìˆ˜ë™ ì§€ì •)
    output_dir: Optional[str]  # ì„ íƒì‚¬í•­
```

**ë¬¸ì œì **:
- `template_dir`, `cad_path`ë¥¼ **ì§ì ‘ ì§€ì •**í•´ì•¼ í•¨
- í´ë˜ìŠ¤/ë©”ì‰¬ ì´ë¦„ë§Œìœ¼ë¡œëŠ” ì•ˆë¨

---

###  ĞµĞ». **PEM_Server** (`PEM_Server/api/models.py:34`)

```python
class PoseEstimationRequest(BaseModel):
    rgb_image: str          # âœ… Base64 RGB ì´ë¯¸ì§€
    depth_image: str        # âœ… Base64 Depth ì´ë¯¸ì§€
    cam_params: dict        # âœ… ì¹´ë©”ë¼ íŒŒë¼ë¯¸í„°
    cad_path: str           # âŒ CAD íŒŒì¼ ê²½ë¡œ (ìˆ˜ë™ ì§€ì •)
    seg_data: List[Dict]    # âŒ ISM ì„¸ê·¸ë©˜í…Œì´ì…˜ ê²°ê³¼ (ìˆ˜ë™ ì „ë‹¬)
    template_dir: str       # âŒ í…œí”Œë¦¿ ë””ë ‰í† ë¦¬ ê²½ë¡œ (ìˆ˜ë™ ì§€ì •)
    det_score_thresh: float = 0.2
    output_dir: Optional[str]
```

**ë¬¸ì œì **:
- `cad_path`, `template_dir`, `seg_data`ë¥¼ **ì§ì ‘ ì§€ì •**í•´ì•¼ í•¨
- ISM ê²°ê³¼ë¥¼ ìˆ˜ë¯¸ í´ë¼ì´ì–¸íŠ¸ê°€ ì „ë‹¬í•´ì•¼ í•¨

---

### 3. **Main_Server** (`Main_Server/api/models.py:118`)

```python
class FullPipelineRequest(BaseModel):
    class_name: str         # âœ… í´ë˜ìŠ¤ ì´ë¦„
    object_name: str        # âœ… ê°ì²´ ì´ë¦„
    input_images: DictÄ±salÄ±ÅŸ  # âœ… ì´ë¯¸ì§€ ê²½ë¡œ
    output_dir: Optional[str]
```

**ì…ë ¥**:
```python
{
    "class_name": "lm",
    "object_name": "obj_000001",
    "input_images": {
        "rgb_path": "static/test/rgb.png",
        "depth_path": "static/test/depth.png",
        "camera_path": "static/test/camera.json"
    }
}
```

**ì¥ì **:
- âœ… í´ë˜ìŠ¤/ê°ì²´ ì´ë¦„ë§Œ ì§€ì •
- âœ… ê²½ë¡œ ìë™ ê³„ì‚° (workflow_serviceì—ì„œ ì²˜ë¦¬)

**ë‹¨ì **:
- âŒ ì´ë¯¸ì§€ë¥¼ íŒŒì¼ ê²½ë¡œë¡œ ì§€ì • (base64 ì•„ë‹˜)
- âŒ ISM, PEM ë‹¨ë… í˜¸ì¶œ ì‹œ ê²½ë¡œ ì§ì ‘ ì§€ì • í•„ìš”

---

## ğŸ” ê²½ë¡œ ìë™ ê³„ì‚° ë¡œì§

### Main_Server (workflow_service.py)

```python
# 1. CAD íŒŒì¼ ê²½ë¡œ ìë™ ê³„ì‚°
cad_path = self.paths["meshes"] / class_name / f"{object_name}.ply"
# â†’ static/meshes/lm/obj_000001.ply

# 2. í…œí”Œë¦¿ ë””ë ‰í† ë¦¬ ìë™ ê³„ì‚°
template_dir = self.paths["templates"] / class_name / object_name
# â†’ static/templates/lm/obj_000001

# 3. í˜¸ìŠ¤íŠ¸ ê²½ë¡œ â†’ ì»¨í…Œì´ë„ˆ ê²½ë¡œ ë³€í™˜
cad_container = self._to_container_path(cad_path_obj)
template_container = self._to_container_path(template_dir_obj)
# â†’ /workspace/Estimation_Server/static/...
```

**ì´ ë¡œì§ì„ ê° ì„œë²„ì— ì ìš©í•˜ë©´** í´ë˜ìŠ¤/ë©”ì‰¬ ì´ë¦„ë§Œìœ¼ë¡œ ë™ì‘ ê°€ëŠ¥!

---

## ğŸ¯ ê°œì„  ë°©ì•ˆ

### ì˜µì…˜ 1: ISM/PEM ì„œë²„ë„ í´ë˜ìŠ¤/ê°ì²´ ì´ë¦„ ë°›ê¸°

```python
# ISM_Server
class InferenceRequest(BaseModel):
    rgb_image: str
    depth_image: str
    cam_params: dict
    class_name: str      # ì¶”ê°€
    object_name: str     # ì¶”ê°€
    output_dir: Optional[str] = None

# ì„œë²„ ë‚´ë¶€ì—ì„œ ê²½ë¡œ ê³„ì‚°
cad_path = f"/workspace/Estimation_Server/static/meshes/{class_name}/{object_name}.ply"
template_dir = f"/workspace/Estimation_Server/static/templates/{class_name}/{object_name}"
```

### ì˜µì…˜ 2: Main_Serverë§Œ ì‚¬ìš© (ì¶”ì²œ)

- âœ… í˜„ì¬ ê°€ì¥ ê°„ë‹¨í•˜ê³  ê¹”ë”í•¨
- âœ… í´ë˜ìŠ¤/ê°ì²´ ì´ë¦„ë§Œ ì§€ì •
- âœ… ê²½ë¡œ ìë™ ê³„ì‚°
- âœ… ISM + PEM ì—°ë™ ìë™ ì²˜ë¦¬

### ì˜µì…˜ 3: í•˜ì´ë¸Œë¦¬ë“œ (ìœ ì—°ì„±)

```python
class InferenceRequest(BaseModel):
    rgb_image: str
    depth_image: str
    cam_params: dict
    
    # ë°©ë²• 1: í´ë˜ìŠ¤/ê°ì²´ ì´ë¦„ ì§€ì •
    class_name: Optional[str] = None
    object_name: Optional[str] = None
    
    # ë°©ë²• 2: ì§ì ‘ ê²½ë¡œ ì§€ì • (ìš°ì„ ìˆœìœ„ ë†’ìŒ)
    cad_path: Optional[str] = None
    template_dir: Optional[str] = None
```

---

## ğŸ“Š í˜„ì¬ ìƒí™© ìš”ì•½

| í•­ëª© | ì‚¬ìš©ì ìš”êµ¬ | ISM_Server | PEM_Server | Main_Server |
|------|------------|-----------|-----------|-------------|
| RGB ì´ë¯¸ì§€ | âœ… | âœ… | âœ… | âš ï¸ íŒŒì¼ ê²½ë¡œ |
| Depth ì´ë¯¸ì§€ | âœ… | âœ… | âœ… | âš ï¸ íŒŒì¼ ê²½ë¡œ |
| ì¹´ë©”ë¼ ìº˜ë¦¬ | âœ… | âœ… | âœ… | âœ… |
| í´ë˜ìŠ¤ ì´ë¦„ | âœ… | âŒ | âŒ | âœ… |
| ë©”ì‰¬ ì´ë¦„ | âœ… | âŒ | âŒ | âœ… |
| í…œí”Œë¦¿ ê²½ë¡œ | âŒ ìë™ | âŒ ìˆ˜ë™ | âŒ ìˆ˜ë™ | âœ… ìë™ |
| CAD ê²½ë¡œ | âŒ ìë™ | âŒ ìˆ˜ë™ | âŒ ìˆ˜ë™ | âœ… ìë™ |

---

## âœ… ê²°ë¡ 

### í˜„ì¬ ì‚¬ìš©ë²• (ì¶”ì²œ)
**Main_Serverì˜ Full Pipeline ì‚¬ìš©**:
```python
POST /api/v1/workflow/full-pipeline
{
    "class_name": "lm",
    "object_name": "obj_000001",
    "input_images": {
        "rgb_path": "...",
        "depth_path": "...",
        "camera_path": "..."
    }
}
```

### ê°œì„  í•„ìš”
**ì´ë¯¸ì§€ë¥¼ base64ë¡œ ë°›ê¸°**:
```python
class FullPipelineRequest(BaseModel):
    class_name: str
    object_name: str
    rgb_image: str          # base64
    depth_image: str        # base64
    cam_params: dict        # dict ì§ì ‘
    output_dir: Optional[str]
```

---

## ğŸ¨ ì•„ì´ë””ì–´ ìŠ¤ì¼€ì¹˜

### ì™„ì „í•œ ì†”ë£¨ì…˜

```python
# ì‚¬ìš©ì ìš”ì²­
{
    "class_name": "lm",
    "object_name": "obj_000001",
    "images": {
        "rgb": "<base64>",
        "depth": "<base64>"
    },
    "camera": {
        "fx": 525.0,
        "fy": 525.0,
        "cx": 319.5,
        "cy": 239.5,
        "depth_scale": 1000.0
    }
}

# Main_Server ì²˜ë¦¬
1. class_name + object_name â†’ ê²½ë¡œ ê³„ì‚°
2. base64 ë””ì½”ë”© â†’ íŒŒì¼ ì €ì¥ (ì„ì‹œ)
3. ISM í˜¸ì¶œ (ê²½ë¡œ ìë™ ì£¼ì…)
4. PEM í˜¸ì¶œ (ê²½ë¡œ ìë™ ì£¼ì…)
5. ê²°ê³¼ ë°˜í™˜
```

ì´ë ‡ê²Œ í•˜ë©´ **í´ë¼ì´ì–¸íŠ¸ëŠ” í´ë˜ìŠ¤/ë©”ì‰¬ ì´ë¦„ê³¼ ì´ë¯¸ì§€ë§Œ ì œê³µ**í•˜ë©´ ë¨!

