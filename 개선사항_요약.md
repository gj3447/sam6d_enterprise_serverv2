# API ê°œì„ ì‚¬í•­ - Base64 ì´ë¯¸ì§€ ì§ì ‘ ì…ë ¥

## ğŸ“‹ ê°œì„  ë‚´ìš©

### ë³€ê²½ ì „ (íŒŒì¼ ê²½ë¡œ ê¸°ë°˜)
```python
POST /api/v1/workflow/full-pipeline
{
    "class_name": "lm",
    "object_name": "obj_000001",
    "input_images": {
        "rgb_path": "static/test/rgb.png",
        "depth_path": "static/test/depth.png",
        "camera_path": "static/test/camera.json"
    }
}
```

**ë‹¨ì **:
- âŒ ì´ë¯¸ì§€ íŒŒì¼ì„ ë¯¸ë¦¬ ì„œë²„ì— ì €ì¥í•´ì•¼ í•¨
- âŒ íŒŒì¼ ê²½ë¡œ ê´€ë¦¬ í•„ìš”
- âŒ í´ë¼ì´ì–¸íŠ¸ê°€ íŒŒì¼ì„ ì—…ë¡œë“œí•˜ëŠ” ì¶”ê°€ ë‹¨ê³„ í•„ìš”

---

### ë³€ê²½ í›„ (Base64 ì§ì ‘ ì…ë ¥)
```python
POST /api/v1/workflow/full-pipeline
{
    "class_name": "lm",
    "object_name": "obj_000001",
    "rgb_image": "<base64_encoded_rgb_image>",
    "depth_image": "<base64_ enumerated_depth_image>",
    "cam_params": {
        "cam_K": [[525.0, 0, 319.5],
                   [0, 525.0, 239.5],
                   [0, 0, 1]],
        "depth_scale": 1000.0
    }
}
```

**ì¥ì **:
- âœ… ì´ë¯¸ì§€ íŒŒì¼ì„ ì§ì ‘ ì „ì†¡ (í•œ ë²ˆì— ì²˜ë¦¬)
- âœ… í´ë¼ì´ì–¸íŠ¸ê°€ íŒŒì¼ ê²½ë¡œë¥¼ ì•Œ í•„ìš” ì—†ìŒ
- âœ… ê°„ë‹¨í•œ API ì‚¬ìš©

---

## ğŸ”§ ìˆ˜ì •ëœ íŒŒì¼

### 1. `Main_Server/api/models.py`

```python
class FullPipelineRequest(BaseModel):
    class_name: str
    object_name: str
    rgb_image: str              # Base64 RGB ì´ë¯¸ì§€
    depth_image: str            # Base64 Depth ì´ë¯¸ì§€
    cam_params: Dict[str, Any]  # ì¹´ë©”ë¼ íŒŒë¼ë¯¸í„°
    output_dir: Optional[str]
```

### 2. `Main_Server/api/endpoints/workflow.py`

```python
@router.post("/full-pipeline")
async def execute_full_pipeline(request: FullPipelineRequest):
    result = await workflow_service.execute_full_pipeline(
        class_name=request.class_name,
        object_name=request.object_name,
        rgb_image=request.rgb_image,        # ì§ì ‘ ì „ë‹¬
        depth_image=request.depth_image,    # ì§ì ‘ ì „ë‹¬
        cam_params=request.cam_params,      # ì§ì ‘ ì „ë‹¬
        output_dir=request.output_dir
    )
```

### 3. `Main_Server/services/workflow_service.py`

#### `execute_full_pipeline` í•¨ìˆ˜
- ì‹œê·¸ë‹ˆì²˜ ë³€ê²½: `input_images` â†’ `rgb_image`, `depth_image`, `cam_params`
- ê²½ë¡œ ê³„ì‚° ì œê±°: ì´ì œ í´ë˜ìŠ¤/ê°ì²´ ì´ë¦„ë§Œìœ¼ë¡œ ê²½ë¡œ ìë™ ê³„ì‚°

#### `_call_ism_server` í•¨ìˆ˜
- ì‹œê·¸ë‹ˆì²˜ ë³€ê²½: base64 ì´ë¯¸ì§€ ì§ì ‘ ë°›ìŒ
- ì¸ì½”ë”© ë¡œì§ ì œê±° (ì´ë¯¸ ì¸ì½”ë”©ë¨)

#### `_call_pem_server` í•¨ìˆ˜
- ì‹œê·¸ë‹ˆì²˜ ë³€ê²½: base64 ì´ë¯¸ì§€ ì§ì ‘ ë°›ìŒ
- ì¸ì½”ë”© ë¡œì§ ì œê±°

---

## ğŸ¯ ì‚¬ìš© ì˜ˆì‹œ

### Python í´ë¼ì´ì–¸íŠ¸

```python
import requests
import base64

# ì´ë¯¸ì§€ íŒŒì¼ ì½ê¸°
with open("rgb.png", "rb") as f:
    rgb_b64 = base64.b64encode(f.read()).decode('utf-8')

with open("depth.png", "rb") as f:
    depth_b64 = base64.b64encode(f.read()).decode('utf-8')

# ì¹´ë©”ë¼ íŒŒë¼ë¯¸í„°
cam_params = {
    "cam_K": [[525.0, 0, 319.5],
              [0, 525.0, 239.5],
              [0, 0, 1]],
    "depth_scale": 1000.0
}

# API ìš”ì²­
response = requests.post(
    "http://localhost:8001/api/v1/workflow/full-pipeline",
    json={
        "class_name": "lm",
        "object_name": "obj_000001",
        "rgb_image": rgb_b64,
        "depth_image": depth_b64,
        "cam_params": cam_params
    }
)
```

---

## âœ… í…ŒìŠ¤íŠ¸ í•„ìš”

ì•„ì§ í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸ ì‘ì„± ë° ê²€ì¦ì´ í•„ìš”í•©ë‹ˆë‹¤.

### ë‹¤ìŒ ë‹¨ê³„:
1. í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸ ì‘ì„±
2. ì‹¤ì œ ì´ë¯¸ì§€ë¡œ í…ŒìŠ¤íŠ¸
3. ê²°ê³¼ ê²€ì¦

